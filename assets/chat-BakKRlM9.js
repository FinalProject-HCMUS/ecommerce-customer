import{j as C,r as N,u as yr,m as wr,g as jr,z as qr,t as Q,i as Lr}from"./index-Cjw31lPW.js";import{B as Ur}from"./Breadcrumb-WRyALT2r.js";import{a as Br}from"./formatDate-C-gaBzhP.js";import{c as Hr}from"./App-XnSzAfIP.js";import{L as lt}from"./Loading-DafqjBgN.js";import{c as Dr}from"./common-Cbvgc8aE.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=Hr("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),Wr=({message:i})=>C.jsxs("div",{className:`flex items-start gap-3 ${i.role==="user"?"justify-end":""}`,children:[i.role==="admin"&&C.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden flex-shrink-0 bg-gray-300",children:C.jsx("img",{src:"/placeholder.svg?height=40&width=40",alt:"User avatar",className:"w-full h-full object-cover"})}),C.jsxs("div",{className:`group max-w-[80%] sm:max-w-[70%] ${i.role==="admin"?"order-1":"order-2"}`,children:[C.jsx("div",{className:`rounded-3xl py-3 px-4 animate-fade-in ${i.role==="user"?"bg-black text-white":"bg-gray-800 text-white"}`,children:i.content}),i.createdAt&&C.jsx("div",{className:"text-xs text-gray-500 mt-1",children:Br(i.createdAt)})]})]}),_r=N.forwardRef(({messages:i,messagesEndRef:e})=>C.jsx("div",{className:"max-w-4xl mx-auto space-y-6 p-4",children:i.length===0?C.jsx("div",{className:"text-center text-gray-500 py-8",children:"No messages yet. Start the conversation!"}):C.jsxs(C.Fragment,{children:[i.map(t=>C.jsx(Wr,{message:t},t.id)),C.jsx("div",{ref:e})]})}));_r.displayName="ChatContainer";const Mr=({onSendMessage:i})=>{const[e,t]=N.useState(""),r=yr(s=>s.auth.userInfo),n=s=>{s.preventDefault(),e.trim()&&(i(e),t(""))};return C.jsx("div",{className:"bg-white border-t p-4",children:C.jsx("div",{className:"max-w-4xl mx-auto",children:C.jsxs("form",{onSubmit:n,className:"flex items-center gap-2",children:[C.jsxs("div",{className:"flex-1 relative",children:[C.jsx("input",{type:"text",value:e,onChange:s=>t(s.target.value),placeholder:"Type something",className:"w-full py-3 px-4 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-200"}),C.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:C.jsx("button",{type:"submit",className:"p-2 rounded-full bg-gray-800 text-white",disabled:!e.trim(),children:C.jsx(Pr,{className:"h-5 w-5"})})})]}),C.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden flex-shrink-0 bg-gray-300",children:C.jsx("img",{src:(r==null?void 0:r.photo)||"/placeholder.svg?height=40&width=40",alt:"Your avatar",className:"w-full h-full object-cover"})})]})})})},Fr=async i=>(await wr.get(`/conversations/customer/${i}`)).data,Vr=()=>{const[i,e]=N.useState({conversations:[],loading:!1}),t=async r=>{e(n=>({...n,loading:!0,error:null}));try{const n=await Fr(r);n.isSuccess&&n.data&&e({conversations:n.data,loading:!1})}finally{e(n=>({...n,loading:!1}))}};return{conversations:i.conversations,loading:i.loading,fetchCustomerConversations:t}},$r=async(i,e=0,t=10,r)=>{const n=new URLSearchParams;return n.append("page",e.toString()),n.append("size",t.toString()),r&&r.length&&r.forEach(o=>n.append("sort",o)),(await wr.get(`/messages/conversation/${i}/paginated?${n.toString()}`)).data},Xr=()=>{const[i,e]=N.useState({messages:[],loading:!1,hasMore:!0,pagination:{page:0,size:10,totalPages:0,totalElements:0}}),t=N.useCallback(async(s,o=0,a=10,u=["createdAt,asc"])=>{var h,c,f;if(!s){e(m=>({...m,error:"Conversation ID is required"}));return}e(m=>({...m,loading:!0,error:null}));try{const m=await $r(s,o,a,u);if(m.isSuccess&&m.data){const E=m.data.totalPages||0,x=(((h=m.data.pageable)==null?void 0:h.pageNumber)||o)<E-1;e({messages:m.data.content,loading:!1,hasMore:x,pagination:{page:((c=m.data.pageable)==null?void 0:c.pageNumber)||o,size:((f=m.data.pageable)==null?void 0:f.pageSize)||a,totalPages:m.data.totalPages||0,totalElements:m.data.totalElements||0}})}else e(E=>({...E,hasMore:!1,loading:!1}))}catch(m){const E=m instanceof Error?m.message:"An unexpected error occurred";e(k=>({...k,loading:!1,hasMore:!1,error:E}))}},[]),r=N.useCallback((s,o,a)=>{t(s,o,i.pagination.size,a)},[t,i.pagination.size]),n=N.useCallback((s,o,a)=>{t(s,0,o,a)},[t]);return{messages:i.messages,loading:i.loading,pagination:i.pagination,hasMore:i.hasMore,fetchMessages:t,changePage:r,changePageSize:n}};var ae={exports:{}},Z={},ht;function Gr(){return ht||(ht=1,window.crypto&&window.crypto.getRandomValues?Z.randomBytes=function(i){var e=new Uint8Array(i);return window.crypto.getRandomValues(e),e}:Z.randomBytes=function(i){for(var e=new Array(i),t=0;t<i;t++)e[t]=Math.floor(Math.random()*256);return e}),Z}var ce,dt;function F(){if(dt)return ce;dt=1;var i=Gr(),e="abcdefghijklmnopqrstuvwxyz012345";return ce={string:function(t){for(var r=e.length,n=i.randomBytes(t),s=[],o=0;o<t;o++)s.push(e.substr(n[o]%r,1));return s.join("")},number:function(t){return Math.floor(Math.random()*t)},numberString:function(t){var r=(""+(t-1)).length,n=new Array(r+1).join("0");return(n+this.number(t)).slice(-r)}},ce}var ft;function W(){return ft||(ft=1,function(i){var e=F(),t={},r=!1,n=window.chrome&&window.chrome.app&&window.chrome.app.runtime;i.exports={attachEvent:function(o,a){typeof window.addEventListener<"u"?window.addEventListener(o,a,!1):window.document&&window.attachEvent&&(window.document.attachEvent("on"+o,a),window.attachEvent("on"+o,a))},detachEvent:function(o,a){typeof window.addEventListener<"u"?window.removeEventListener(o,a,!1):window.document&&window.detachEvent&&(window.document.detachEvent("on"+o,a),window.detachEvent("on"+o,a))},unloadAdd:function(o){if(n)return null;var a=e.string(8);return t[a]=o,r&&setTimeout(this.triggerUnloadCallbacks,0),a},unloadDel:function(o){o in t&&delete t[o]},triggerUnloadCallbacks:function(){for(var o in t)t[o](),delete t[o]}};var s=function(){r||(r=!0,i.exports.triggerUnloadCallbacks())};n||i.exports.attachEvent("unload",s)}(ae)),ae.exports}var ue,pt;function Jr(){return pt||(pt=1,ue=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}),ue}var Y={},mt;function zr(){if(mt)return Y;mt=1;var i=Object.prototype.hasOwnProperty,e;function t(o){try{return decodeURIComponent(o.replace(/\+/g," "))}catch{return null}}function r(o){try{return encodeURIComponent(o)}catch{return null}}function n(o){for(var a=/([^=?#&]+)=?([^&]*)/g,u={},h;h=a.exec(o);){var c=t(h[1]),f=t(h[2]);c===null||f===null||c in u||(u[c]=f)}return u}function s(o,a){a=a||"";var u=[],h,c;typeof a!="string"&&(a="?");for(c in o)if(i.call(o,c)){if(h=o[c],!h&&(h===null||h===e||isNaN(h))&&(h=""),c=r(c),h=r(h),c===null||h===null)continue;u.push(c+"="+h)}return u.length?a+u.join("&"):""}return Y.stringify=s,Y.parse=n,Y}var le,gt;function Er(){if(gt)return le;gt=1;var i=Jr(),e=zr(),t=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,r=/[\n\r\t]/g,n=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,s=/:\d+$/,o=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,a=/^[a-zA-Z]:/;function u(p){return(p||"").toString().replace(t,"")}var h=[["#","hash"],["?","query"],function(y,d){return m(d.protocol)?y.replace(/\\/g,"/"):y},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],c={hash:1,query:1};function f(p){var y;typeof window<"u"||typeof window<"u"?y=window:typeof self<"u"?y=self:y={};var d=y.location||{};p=p||d;var g={},w=typeof p,v;if(p.protocol==="blob:")g=new x(unescape(p.pathname),{});else if(w==="string"){g=new x(p,{});for(v in c)delete g[v]}else if(w==="object"){for(v in p)v in c||(g[v]=p[v]);g.slashes===void 0&&(g.slashes=n.test(p.href))}return g}function m(p){return p==="file:"||p==="ftp:"||p==="http:"||p==="https:"||p==="ws:"||p==="wss:"}function E(p,y){p=u(p),p=p.replace(r,""),y=y||{};var d=o.exec(p),g=d[1]?d[1].toLowerCase():"",w=!!d[2],v=!!d[3],l=0,b;return w?v?(b=d[2]+d[3]+d[4],l=d[2].length+d[3].length):(b=d[2]+d[4],l=d[2].length):v?(b=d[3]+d[4],l=d[3].length):b=d[4],g==="file:"?l>=2&&(b=b.slice(2)):m(g)?b=d[4]:g?w&&(b=b.slice(2)):l>=2&&m(y.protocol)&&(b=d[4]),{protocol:g,slashes:w||m(g),slashesCount:l,rest:b}}function k(p,y){if(p==="")return y;for(var d=(y||"/").split("/").slice(0,-1).concat(p.split("/")),g=d.length,w=d[g-1],v=!1,l=0;g--;)d[g]==="."?d.splice(g,1):d[g]===".."?(d.splice(g,1),l++):l&&(g===0&&(v=!0),d.splice(g,1),l--);return v&&d.unshift(""),(w==="."||w==="..")&&d.push(""),d.join("/")}function x(p,y,d){if(p=u(p),p=p.replace(r,""),!(this instanceof x))return new x(p,y,d);var g,w,v,l,b,S,T=h.slice(),A=typeof y,_=this,H=0;for(A!=="object"&&A!=="string"&&(d=y,y=null),d&&typeof d!="function"&&(d=e.parse),y=f(y),w=E(p||"",y),g=!w.protocol&&!w.slashes,_.slashes=w.slashes||g&&y.slashes,_.protocol=w.protocol||y.protocol||"",p=w.rest,(w.protocol==="file:"&&(w.slashesCount!==2||a.test(p))||!w.slashes&&(w.protocol||w.slashesCount<2||!m(_.protocol)))&&(T[3]=[/(.*)/,"pathname"]);H<T.length;H++){if(l=T[H],typeof l=="function"){p=l(p,_);continue}v=l[0],S=l[1],v!==v?_[S]=p:typeof v=="string"?(b=v==="@"?p.lastIndexOf(v):p.indexOf(v),~b&&(typeof l[2]=="number"?(_[S]=p.slice(0,b),p=p.slice(b+l[2])):(_[S]=p.slice(b),p=p.slice(0,b)))):(b=v.exec(p))&&(_[S]=b[1],p=p.slice(0,b.index)),_[S]=_[S]||g&&l[3]&&y[S]||"",l[4]&&(_[S]=_[S].toLowerCase())}d&&(_.query=d(_.query)),g&&y.slashes&&_.pathname.charAt(0)!=="/"&&(_.pathname!==""||y.pathname!=="")&&(_.pathname=k(_.pathname,y.pathname)),_.pathname.charAt(0)!=="/"&&m(_.protocol)&&(_.pathname="/"+_.pathname),i(_.port,_.protocol)||(_.host=_.hostname,_.port=""),_.username=_.password="",_.auth&&(b=_.auth.indexOf(":"),~b?(_.username=_.auth.slice(0,b),_.username=encodeURIComponent(decodeURIComponent(_.username)),_.password=_.auth.slice(b+1),_.password=encodeURIComponent(decodeURIComponent(_.password))):_.username=encodeURIComponent(decodeURIComponent(_.auth)),_.auth=_.password?_.username+":"+_.password:_.username),_.origin=_.protocol!=="file:"&&m(_.protocol)&&_.host?_.protocol+"//"+_.host:"null",_.href=_.toString()}function O(p,y,d){var g=this;switch(p){case"query":typeof y=="string"&&y.length&&(y=(d||e.parse)(y)),g[p]=y;break;case"port":g[p]=y,i(y,g.protocol)?y&&(g.host=g.hostname+":"+y):(g.host=g.hostname,g[p]="");break;case"hostname":g[p]=y,g.port&&(y+=":"+g.port),g.host=y;break;case"host":g[p]=y,s.test(y)?(y=y.split(":"),g.port=y.pop(),g.hostname=y.join(":")):(g.hostname=y,g.port="");break;case"protocol":g.protocol=y.toLowerCase(),g.slashes=!d;break;case"pathname":case"hash":if(y){var w=p==="pathname"?"/":"#";g[p]=y.charAt(0)!==w?w+y:y}else g[p]=y;break;case"username":case"password":g[p]=encodeURIComponent(y);break;case"auth":var v=y.indexOf(":");~v?(g.username=y.slice(0,v),g.username=encodeURIComponent(decodeURIComponent(g.username)),g.password=y.slice(v+1),g.password=encodeURIComponent(decodeURIComponent(g.password))):g.username=encodeURIComponent(decodeURIComponent(y))}for(var l=0;l<h.length;l++){var b=h[l];b[4]&&(g[b[1]]=g[b[1]].toLowerCase())}return g.auth=g.password?g.username+":"+g.password:g.username,g.origin=g.protocol!=="file:"&&m(g.protocol)&&g.host?g.protocol+"//"+g.host:"null",g.href=g.toString(),g}function R(p){(!p||typeof p!="function")&&(p=e.stringify);var y,d=this,g=d.host,w=d.protocol;w&&w.charAt(w.length-1)!==":"&&(w+=":");var v=w+(d.protocol&&d.slashes||m(d.protocol)?"//":"");return d.username?(v+=d.username,d.password&&(v+=":"+d.password),v+="@"):d.password?(v+=":"+d.password,v+="@"):d.protocol!=="file:"&&m(d.protocol)&&!g&&d.pathname!=="/"&&(v+="@"),(g[g.length-1]===":"||s.test(d.hostname)&&!d.port)&&(g+=":"),v+=g+d.pathname,y=typeof d.query=="object"?p(d.query):d.query,y&&(v+=y.charAt(0)!=="?"?"?"+y:y),d.hash&&(v+=d.hash),v}return x.prototype={set:O,toString:R},x.extractProtocol=E,x.location=f,x.trimLeft=u,x.qs=e,le=x,le}var he,vt;function U(){if(vt)return he;vt=1;var i=Er();return he={getOrigin:function(e){if(!e)return null;var t=new i(e);if(t.protocol==="file:")return null;var r=t.port;return r||(r=t.protocol==="https:"?"443":"80"),t.protocol+"//"+t.hostname+":"+r},isOriginEqual:function(e,t){var r=this.getOrigin(e)===this.getOrigin(t);return r},isSchemeEqual:function(e,t){return e.split(":")[0]===t.split(":")[0]},addPath:function(e,t){var r=e.split("?");return r[0]+t+(r[1]?"?"+r[1]:"")},addQuery:function(e,t){return e+(e.indexOf("?")===-1?"?"+t:"&"+t)},isLoopbackAddr:function(e){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^\[::1\]$/.test(e)}},he}var ee={exports:{}},bt;function I(){return bt||(bt=1,typeof Object.create=="function"?ee.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:ee.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}),ee.exports}var de={},fe,yt;function xr(){if(yt)return fe;yt=1;function i(){this._listeners={}}return i.prototype.addEventListener=function(e,t){e in this._listeners||(this._listeners[e]=[]);var r=this._listeners[e];r.indexOf(t)===-1&&(r=r.concat([t])),this._listeners[e]=r},i.prototype.removeEventListener=function(e,t){var r=this._listeners[e];if(r){var n=r.indexOf(t);if(n!==-1){r.length>1?this._listeners[e]=r.slice(0,n).concat(r.slice(n+1)):delete this._listeners[e];return}}},i.prototype.dispatchEvent=function(){var e=arguments[0],t=e.type,r=arguments.length===1?[e]:Array.apply(null,arguments);if(this["on"+t]&&this["on"+t].apply(this,r),t in this._listeners)for(var n=this._listeners[t],s=0;s<n.length;s++)n[s].apply(this,r)},fe=i,fe}var wt;function L(){if(wt)return de;wt=1;var i=I(),e=xr();function t(){e.call(this)}return i(t,e),t.prototype.removeAllListeners=function(r){r?delete this._listeners[r]:this._listeners={}},t.prototype.once=function(r,n){var s=this,o=!1;function a(){s.removeListener(r,a),o||(o=!0,n.apply(this,arguments))}this.on(r,a)},t.prototype.emit=function(){var r=arguments[0],n=this._listeners[r];if(n){for(var s=arguments.length,o=new Array(s-1),a=1;a<s;a++)o[a-1]=arguments[a];for(var u=0;u<n.length;u++)n[u].apply(this,o)}},t.prototype.on=t.prototype.addListener=e.prototype.addEventListener,t.prototype.removeListener=e.prototype.removeEventListener,de.EventEmitter=t,de}var te={exports:{}},_t;function Kr(){if(_t)return te.exports;_t=1;var i=window.WebSocket||window.MozWebSocket;return i?te.exports=function(t){return new i(t)}:te.exports=void 0,te.exports}var pe,Et;function Qr(){if(Et)return pe;Et=1;var i=W(),e=U(),t=I(),r=L().EventEmitter,n=Kr(),s=function(){};function o(a,u,h){if(!o.enabled())throw new Error("Transport created when disabled");r.call(this);var c=this,f=e.addPath(a,"/websocket");f.slice(0,5)==="https"?f="wss"+f.slice(5):f="ws"+f.slice(4),this.url=f,this.ws=new n(this.url,[],h),this.ws.onmessage=function(m){s("message event",m.data),c.emit("message",m.data)},this.unloadRef=i.unloadAdd(function(){c.ws.close()}),this.ws.onclose=function(m){s("close event",m.code,m.reason),c.emit("close",m.code,m.reason),c._cleanup()},this.ws.onerror=function(m){c.emit("close",1006,"WebSocket connection broken"),c._cleanup()}}return t(o,r),o.prototype.send=function(a){var u="["+a+"]";this.ws.send(u)},o.prototype.close=function(){var a=this.ws;this._cleanup(),a&&a.close()},o.prototype._cleanup=function(){var a=this.ws;a&&(a.onmessage=a.onclose=a.onerror=null),i.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},o.enabled=function(){return!!n},o.transportName="websocket",o.roundTrips=2,pe=o,pe}var me,xt;function Zr(){if(xt)return me;xt=1;var i=I(),e=L().EventEmitter,t=function(){};function r(n,s){e.call(this),this.sendBuffer=[],this.sender=s,this.url=n}return i(r,e),r.prototype.send=function(n){this.sendBuffer.push(n),this.sendStop||this.sendSchedule()},r.prototype.sendScheduleWait=function(){var n=this,s;this.sendStop=function(){n.sendStop=null,clearTimeout(s)},s=setTimeout(function(){n.sendStop=null,n.sendSchedule()},25)},r.prototype.sendSchedule=function(){t("sendSchedule",this.sendBuffer.length);var n=this;if(this.sendBuffer.length>0){var s="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,s,function(o){n.sendStop=null,o?(n.emit("close",o.code||1006,"Sending error: "+o),n.close()):n.sendScheduleWait()}),this.sendBuffer=[]}},r.prototype._cleanup=function(){this.removeAllListeners()},r.prototype.close=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},me=r,me}var ge,St;function Yr(){if(St)return ge;St=1;var i=I(),e=L().EventEmitter,t=function(){};function r(n,s,o){e.call(this),this.Receiver=n,this.receiveUrl=s,this.AjaxObject=o,this._scheduleReceiver()}return i(r,e),r.prototype._scheduleReceiver=function(){var n=this,s=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);s.on("message",function(o){n.emit("message",o)}),s.once("close",function(o,a){t("close",o,a,n.pollIsClosing),n.poll=s=null,n.pollIsClosing||(a==="network"?n._scheduleReceiver():(n.emit("close",o||1006,a),n.removeAllListeners()))})},r.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},ge=r,ge}var ve,Ct;function Sr(){if(Ct)return ve;Ct=1;var i=I(),e=U(),t=Zr(),r=Yr();function n(s,o,a,u,h){var c=e.addPath(s,o),f=this;t.call(this,s,a),this.poll=new r(u,c,h),this.poll.on("message",function(m){f.emit("message",m)}),this.poll.once("close",function(m,E){f.poll=null,f.emit("close",m,E),f.close()})}return i(n,t),n.prototype.close=function(){t.prototype.close.call(this),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)},ve=n,ve}var be,kt;function V(){if(kt)return be;kt=1;var i=I(),e=U(),t=Sr();function r(s){return function(o,a,u){var h={};typeof a=="string"&&(h.headers={"Content-type":"text/plain"});var c=e.addPath(o,"/xhr_send"),f=new s("POST",c,a,h);return f.once("finish",function(m){if(f=null,m!==200&&m!==204)return u(new Error("http status "+m));u()}),function(){f.close(),f=null;var m=new Error("Aborted");m.code=1e3,u(m)}}}function n(s,o,a,u){t.call(this,s,o,r(u),a,u)}return i(n,t),be=n,be}var ye,Rt;function se(){if(Rt)return ye;Rt=1;var i=I(),e=L().EventEmitter;function t(r,n){e.call(this);var s=this;this.bufferPosition=0,this.xo=new n("POST",r,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(o,a){s._chunkHandler(o,a),s.xo=null;var u=o===200?"network":"permanent";s.emit("close",null,u),s._cleanup()})}return i(t,e),t.prototype._chunkHandler=function(r,n){if(!(r!==200||!n))for(var s=-1;;this.bufferPosition+=s+1){var o=n.slice(this.bufferPosition);if(s=o.indexOf(`
`),s===-1)break;var a=o.slice(0,s);a&&this.emit("message",a)}},t.prototype._cleanup=function(){this.removeAllListeners()},t.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},ye=t,ye}var we,Tt;function Cr(){if(Tt)return we;Tt=1;var i=L().EventEmitter,e=I(),t=W(),r=U(),n=window.XMLHttpRequest,s=function(){};function o(h,c,f,m){var E=this;i.call(this),setTimeout(function(){E._start(h,c,f,m)},0)}e(o,i),o.prototype._start=function(h,c,f,m){var E=this;try{this.xhr=new n}catch{}if(!this.xhr){this.emit("finish",0,"no xhr support"),this._cleanup();return}c=r.addQuery(c,"t="+ +new Date),this.unloadRef=t.unloadAdd(function(){E._cleanup(!0)});try{this.xhr.open(h,c,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){s("xhr timeout"),E.emit("finish",0,""),E._cleanup(!1)})}catch{this.emit("finish",0,""),this._cleanup(!1);return}if((!m||!m.noCredentials)&&o.supportsCORS&&(this.xhr.withCredentials=!0),m&&m.headers)for(var k in m.headers)this.xhr.setRequestHeader(k,m.headers[k]);this.xhr.onreadystatechange=function(){if(E.xhr){var x=E.xhr,O,R;switch(s("readyState",x.readyState),x.readyState){case 3:try{R=x.status,O=x.responseText}catch{}R===1223&&(R=204),R===200&&O&&O.length>0&&E.emit("chunk",R,O);break;case 4:R=x.status,R===1223&&(R=204),(R===12005||R===12029)&&(R=0),s("finish",R,x.responseText),E.emit("finish",R,x.responseText),E._cleanup(!1);break}}};try{E.xhr.send(f)}catch{E.emit("finish",0,""),E._cleanup(!1)}},o.prototype._cleanup=function(h){if(this.xhr){if(this.removeAllListeners(),t.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),h)try{this.xhr.abort()}catch{}this.unloadRef=this.xhr=null}},o.prototype.close=function(){this._cleanup(!0)},o.enabled=!!n;var a=["Active"].concat("Object").join("X");!o.enabled&&a in window&&(n=function(){try{return new window[a]("Microsoft.XMLHTTP")}catch{return null}},o.enabled=!!new n);var u=!1;try{u="withCredentials"in new n}catch{}return o.supportsCORS=u,we=o,we}var _e,It;function oe(){if(It)return _e;It=1;var i=I(),e=Cr();function t(r,n,s,o){e.call(this,r,n,s,o)}return i(t,e),t.enabled=e.enabled&&e.supportsCORS,_e=t,_e}var Ee,Ot;function G(){if(Ot)return Ee;Ot=1;var i=I(),e=Cr();function t(r,n,s){e.call(this,r,n,s,{noCredentials:!0})}return i(t,e),t.enabled=e.enabled,Ee=t,Ee}var xe,Nt;function J(){return Nt||(Nt=1,xe={isOpera:function(){return window.navigator&&/opera/i.test(window.navigator.userAgent)},isKonqueror:function(){return window.navigator&&/konqueror/i.test(window.navigator.userAgent)},hasDomain:function(){if(!window.document)return!0;try{return!!window.document.domain}catch{return!1}}}),xe}var Se,At;function en(){if(At)return Se;At=1;var i=I(),e=V(),t=se(),r=oe(),n=G(),s=J();function o(a){if(!n.enabled&&!r.enabled)throw new Error("Transport created when disabled");e.call(this,a,"/xhr_streaming",t,r)}return i(o,e),o.enabled=function(a){return a.nullOrigin||s.isOpera()?!1:r.enabled},o.transportName="xhr-streaming",o.roundTrips=2,o.needBody=!!window.document,Se=o,Se}var Ce,jt;function ot(){if(jt)return Ce;jt=1;var i=L().EventEmitter,e=I(),t=W(),r=J(),n=U(),s=function(){};function o(a,u,h){var c=this;i.call(this),setTimeout(function(){c._start(a,u,h)},0)}return e(o,i),o.prototype._start=function(a,u,h){var c=this,f=new window.XDomainRequest;u=n.addQuery(u,"t="+ +new Date),f.onerror=function(){c._error()},f.ontimeout=function(){c._error()},f.onprogress=function(){s("progress",f.responseText),c.emit("chunk",200,f.responseText)},f.onload=function(){c.emit("finish",200,f.responseText),c._cleanup(!1)},this.xdr=f,this.unloadRef=t.unloadAdd(function(){c._cleanup(!0)});try{this.xdr.open(a,u),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(h)}catch{this._error()}},o.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},o.prototype._cleanup=function(a){if(this.xdr){if(this.removeAllListeners(),t.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,a)try{this.xdr.abort()}catch{}this.unloadRef=this.xdr=null}},o.prototype.close=function(){this._cleanup(!0)},o.enabled=!!(window.XDomainRequest&&r.hasDomain()),Ce=o,Ce}var ke,qt;function kr(){if(qt)return ke;qt=1;var i=I(),e=V(),t=se(),r=ot();function n(s){if(!r.enabled)throw new Error("Transport created when disabled");e.call(this,s,"/xhr_streaming",t,r)}return i(n,e),n.enabled=function(s){return s.cookie_needed||s.nullOrigin?!1:r.enabled&&s.sameScheme},n.transportName="xdr-streaming",n.roundTrips=2,ke=n,ke}var Re,Lt;function Rr(){return Lt||(Lt=1,Re=window.EventSource),Re}var Te,Ut;function tn(){if(Ut)return Te;Ut=1;var i=I(),e=L().EventEmitter,t=Rr(),r=function(){};function n(s){e.call(this);var o=this,a=this.es=new t(s);a.onmessage=function(u){r("message",u.data),o.emit("message",decodeURI(u.data))},a.onerror=function(u){r("error",a.readyState);var h=a.readyState!==2?"network":"permanent";o._cleanup(),o._close(h)}}return i(n,e),n.prototype.abort=function(){this._cleanup(),this._close("user")},n.prototype._cleanup=function(){var s=this.es;s&&(s.onmessage=s.onerror=null,s.close(),this.es=null)},n.prototype._close=function(s){var o=this;setTimeout(function(){o.emit("close",null,s),o.removeAllListeners()},200)},Te=n,Te}var Ie,Bt;function Ht(){if(Bt)return Ie;Bt=1;var i=I(),e=V(),t=tn(),r=oe(),n=Rr();function s(o){if(!s.enabled())throw new Error("Transport created when disabled");e.call(this,o,"/eventsource",t,r)}return i(s,e),s.enabled=function(){return!!n},s.transportName="eventsource",s.roundTrips=2,Ie=s,Ie}var Oe,Dt;function Tr(){return Dt||(Dt=1,Oe="1.6.1"),Oe}var Ne={exports:{}},Pt;function z(){return Pt||(Pt=1,function(i){var e=W(),t=J();i.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){i.exports.WPrefix in window||(window[i.exports.WPrefix]={})},postMessage:function(r,n){window.parent!==window&&window.parent.postMessage(JSON.stringify({windowId:i.exports.currentWindowId,type:r,data:n||""}),"*")},createIframe:function(r,n){var s=window.document.createElement("iframe"),o,a,u=function(){clearTimeout(o);try{s.onload=null}catch{}s.onerror=null},h=function(){s&&(u(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),e.unloadDel(a))},c=function(m){s&&(h(),n(m))},f=function(m,E){setTimeout(function(){try{s&&s.contentWindow&&s.contentWindow.postMessage(m,E)}catch{}},0)};return s.src=r,s.style.display="none",s.style.position="absolute",s.onerror=function(){c("onerror")},s.onload=function(){clearTimeout(o),o=setTimeout(function(){c("onload timeout")},2e3)},window.document.body.appendChild(s),o=setTimeout(function(){c("timeout")},15e3),a=e.unloadAdd(h),{post:f,cleanup:h,loaded:u}},createHtmlfile:function(r,n){var s=["Active"].concat("Object").join("X"),o=new window[s]("htmlfile"),a,u,h,c=function(){clearTimeout(a),h.onerror=null},f=function(){o&&(c(),e.unloadDel(u),h.parentNode.removeChild(h),h=o=null,CollectGarbage())},m=function(x){o&&(f(),n(x))},E=function(x,O){try{setTimeout(function(){h&&h.contentWindow&&h.contentWindow.postMessage(x,O)},0)}catch{}};o.open(),o.write('<html><script>document.domain="'+window.document.domain+'";<\/script></html>'),o.close(),o.parentWindow[i.exports.WPrefix]=window[i.exports.WPrefix];var k=o.createElement("div");return o.body.appendChild(k),h=o.createElement("iframe"),k.appendChild(h),h.src=r,h.onerror=function(){m("onerror")},a=setTimeout(function(){m("timeout")},15e3),u=e.unloadAdd(f),{post:E,cleanup:f,loaded:c}}},i.exports.iframeEnabled=!1,window.document&&(i.exports.iframeEnabled=(typeof window.postMessage=="function"||typeof window.postMessage=="object")&&!t.isKonqueror())}(Ne)),Ne.exports}var Ae,Wt;function Ir(){if(Wt)return Ae;Wt=1;var i=I(),e=L().EventEmitter,t=Tr(),r=U(),n=z(),s=W(),o=F(),a=function(){};function u(h,c,f){if(!u.enabled())throw new Error("Transport created when disabled");e.call(this);var m=this;this.origin=r.getOrigin(f),this.baseUrl=f,this.transUrl=c,this.transport=h,this.windowId=o.string(8);var E=r.addPath(f,"/iframe.html")+"#"+this.windowId;this.iframeObj=n.createIframe(E,function(k){m.emit("close",1006,"Unable to load an iframe ("+k+")"),m.close()}),this.onmessageCallback=this._message.bind(this),s.attachEvent("message",this.onmessageCallback)}return i(u,e),u.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){s.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch{}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},u.prototype._message=function(h){if(a("message",h.data),!r.isOriginEqual(h.origin,this.origin)){a("not same origin",h.origin,this.origin);return}var c;try{c=JSON.parse(h.data)}catch{a("bad json",h.data);return}if(c.windowId!==this.windowId){a("mismatched window id",c.windowId,this.windowId);return}switch(c.type){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([t,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",c.data);break;case"c":var f;try{f=JSON.parse(c.data)}catch{a("bad json",c.data);return}this.emit("close",f[0],f[1]),this.close();break}},u.prototype.postMessage=function(h,c){this.iframeObj.post(JSON.stringify({windowId:this.windowId,type:h,data:c||""}),this.origin)},u.prototype.send=function(h){this.postMessage("m",h)},u.enabled=function(){return n.iframeEnabled},u.transportName="iframe",u.roundTrips=2,Ae=u,Ae}var je,Mt;function at(){return Mt||(Mt=1,je={isObject:function(i){var e=typeof i;return e==="function"||e==="object"&&!!i},extend:function(i){if(!this.isObject(i))return i;for(var e,t,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i[t]=e[t])}return i}}),je}var qe,Ft;function Le(){if(Ft)return qe;Ft=1;var i=I(),e=Ir(),t=at();return qe=function(r){function n(s,o){e.call(this,r.transportName,s,o)}return i(n,e),n.enabled=function(s,o){if(!window.document)return!1;var a=t.extend({},o);return a.sameOrigin=!0,r.enabled(a)&&e.enabled()},n.transportName="iframe-"+r.transportName,n.needBody=!0,n.roundTrips=e.roundTrips+r.roundTrips-1,n.facadeTransport=r,n},qe}var Ue,Vt;function rn(){if(Vt)return Ue;Vt=1;var i=I(),e=z(),t=U(),r=L().EventEmitter,n=F(),s=function(){};function o(u){r.call(this);var h=this;e.polluteGlobalNamespace(),this.id="a"+n.string(6),u=t.addQuery(u,"c="+decodeURIComponent(e.WPrefix+"."+this.id)),s("using htmlfile",o.htmlfileEnabled);var c=o.htmlfileEnabled?e.createHtmlfile:e.createIframe;window[e.WPrefix][this.id]={start:function(){h.iframeObj.loaded()},message:function(f){h.emit("message",f)},stop:function(){h._cleanup(),h._close("network")}},this.iframeObj=c(u,function(){h._cleanup(),h._close("permanent")})}i(o,r),o.prototype.abort=function(){this._cleanup(),this._close("user")},o.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete window[e.WPrefix][this.id]},o.prototype._close=function(u){this.emit("close",null,u),this.removeAllListeners()},o.htmlfileEnabled=!1;var a=["Active"].concat("Object").join("X");if(a in window)try{o.htmlfileEnabled=!!new window[a]("htmlfile")}catch{}return o.enabled=o.htmlfileEnabled||e.iframeEnabled,Ue=o,Ue}var Be,$t;function Xt(){if($t)return Be;$t=1;var i=I(),e=rn(),t=G(),r=V();function n(s){if(!e.enabled)throw new Error("Transport created when disabled");r.call(this,s,"/htmlfile",e,t)}return i(n,r),n.enabled=function(s){return e.enabled&&s.sameOrigin},n.transportName="htmlfile",n.roundTrips=2,Be=n,Be}var He,Gt;function Jt(){if(Gt)return He;Gt=1;var i=I(),e=V(),t=se(),r=oe(),n=G();function s(o){if(!n.enabled&&!r.enabled)throw new Error("Transport created when disabled");e.call(this,o,"/xhr",t,r)}return i(s,e),s.enabled=function(o){return o.nullOrigin?!1:n.enabled&&o.sameOrigin?!0:r.enabled},s.transportName="xhr-polling",s.roundTrips=2,He=s,He}var De,zt;function nn(){if(zt)return De;zt=1;var i=I(),e=V(),t=kr(),r=se(),n=ot();function s(o){if(!n.enabled)throw new Error("Transport created when disabled");e.call(this,o,"/xhr",r,n)}return i(s,e),s.enabled=t.enabled,s.transportName="xdr-polling",s.roundTrips=2,De=s,De}var Pe,Kt;function sn(){if(Kt)return Pe;Kt=1;var i=z(),e=F(),t=J(),r=U(),n=I(),s=L().EventEmitter,o=function(){};function a(u){var h=this;s.call(this),i.polluteGlobalNamespace(),this.id="a"+e.string(6);var c=r.addQuery(u,"c="+encodeURIComponent(i.WPrefix+"."+this.id));window[i.WPrefix][this.id]=this._callback.bind(this),this._createScript(c),this.timeoutId=setTimeout(function(){h._abort(new Error("JSONP script loaded abnormally (timeout)"))},a.timeout)}return n(a,s),a.prototype.abort=function(){if(window[i.WPrefix][this.id]){var u=new Error("JSONP user aborted read");u.code=1e3,this._abort(u)}},a.timeout=35e3,a.scriptErrorTimeout=1e3,a.prototype._callback=function(u){this._cleanup(),!this.aborting&&(u&&this.emit("message",u),this.emit("close",null,"network"),this.removeAllListeners())},a.prototype._abort=function(u){this._cleanup(),this.aborting=!0,this.emit("close",u.code,u.message),this.removeAllListeners()},a.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var u=this.script;u.parentNode.removeChild(u),u.onreadystatechange=u.onerror=u.onload=u.onclick=null,this.script=null}delete window[i.WPrefix][this.id]},a.prototype._scriptError=function(){var u=this;this.errorTimer||(this.errorTimer=setTimeout(function(){u.loadedOkay||u._abort(new Error("JSONP script loaded abnormally (onerror)"))},a.scriptErrorTimeout))},a.prototype._createScript=function(u){var h=this,c=this.script=window.document.createElement("script"),f;if(c.id="a"+e.string(8),c.src=u,c.type="text/javascript",c.charset="UTF-8",c.onerror=this._scriptError.bind(this),c.onload=function(){h._abort(new Error("JSONP script loaded abnormally (onload)"))},c.onreadystatechange=function(){if(o("onreadystatechange",c.readyState),/loaded|closed/.test(c.readyState)){if(c&&c.htmlFor&&c.onclick){h.loadedOkay=!0;try{c.onclick()}catch{}}c&&h._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},typeof c.async>"u"&&window.document.attachEvent)if(t.isOpera())f=this.script2=window.document.createElement("script"),f.text="try{var a = document.getElementById('"+c.id+"'); if(a)a.onerror();}catch(x){};",c.async=f.async=!1;else{try{c.htmlFor=c.id,c.event="onclick"}catch{}c.async=!0}typeof c.async<"u"&&(c.async=!0);var m=window.document.getElementsByTagName("head")[0];m.insertBefore(c,m.firstChild),f&&m.insertBefore(f,m.firstChild)},Pe=a,Pe}var We,Qt;function on(){if(Qt)return We;Qt=1;var i=F(),e=U(),t=function(){},r,n;function s(a){try{return window.document.createElement('<iframe name="'+a+'">')}catch{var u=window.document.createElement("iframe");return u.name=a,u}}function o(){r=window.document.createElement("form"),r.style.display="none",r.style.position="absolute",r.method="POST",r.enctype="application/x-www-form-urlencoded",r.acceptCharset="UTF-8",n=window.document.createElement("textarea"),n.name="d",r.appendChild(n),window.document.body.appendChild(r)}return We=function(a,u,h){r||o();var c="a"+i.string(8);r.target=c,r.action=e.addQuery(e.addPath(a,"/jsonp_send"),"i="+c);var f=s(c);f.id=c,f.style.display="none",r.appendChild(f);try{n.value=u}catch{}r.submit();var m=function(E){f.onerror&&(f.onreadystatechange=f.onerror=f.onload=null,setTimeout(function(){f.parentNode.removeChild(f),f=null},500),n.value="",h(E))};return f.onerror=function(){m()},f.onload=function(){m()},f.onreadystatechange=function(E){t("onreadystatechange",c,f.readyState),f.readyState==="complete"&&m()},function(){m(new Error("Aborted"))}},We}var Me,Zt;function an(){if(Zt)return Me;Zt=1;var i=I(),e=Sr(),t=sn(),r=on();function n(s){if(!n.enabled())throw new Error("Transport created when disabled");e.call(this,s,"/jsonp",r,t)}return i(n,e),n.enabled=function(){return!!window.document},n.transportName="jsonp-polling",n.roundTrips=1,n.needBody=!0,Me=n,Me}var Fe,Yt;function cn(){return Yt||(Yt=1,Fe=[Qr(),en(),kr(),Ht(),Le()(Ht()),Xt(),Le()(Xt()),Jt(),nn(),Le()(Jt()),an()]),Fe}var er={},tr;function un(){if(tr)return er;tr=1;var i=Array.prototype,e=Object.prototype,t=Function.prototype,r=String.prototype,n=i.slice,s=e.toString,o=function(v){return e.toString.call(v)==="[object Function]"},a=function(l){return s.call(l)==="[object Array]"},u=function(l){return s.call(l)==="[object String]"},h=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch{return!1}}(),c;h?c=function(v,l,b,S){!S&&l in v||Object.defineProperty(v,l,{configurable:!0,enumerable:!1,writable:!0,value:b})}:c=function(v,l,b,S){!S&&l in v||(v[l]=b)};var f=function(v,l,b){for(var S in l)e.hasOwnProperty.call(l,S)&&c(v,S,l[S],b)},m=function(v){if(v==null)throw new TypeError("can't convert "+v+" to object");return Object(v)};function E(v){var l=+v;return l!==l?l=0:l!==0&&l!==1/0&&l!==-1/0&&(l=(l>0||-1)*Math.floor(Math.abs(l))),l}function k(v){return v>>>0}function x(){}f(t,{bind:function(l){var b=this;if(!o(b))throw new TypeError("Function.prototype.bind called on incompatible "+b);for(var S=n.call(arguments,1),T=function(){if(this instanceof j){var M=b.apply(this,S.concat(n.call(arguments)));return Object(M)===M?M:this}else return b.apply(l,S.concat(n.call(arguments)))},A=Math.max(0,b.length-S.length),_=[],H=0;H<A;H++)_.push("$"+H);var j=Function("binder","return function ("+_.join(",")+"){ return binder.apply(this, arguments); }")(T);return b.prototype&&(x.prototype=b.prototype,j.prototype=new x,x.prototype=null),j}}),f(Array,{isArray:a});var O=Object("a"),R=O[0]!=="a"||!(0 in O),p=function(l){var b=!0,S=!0;return l&&(l.call("foo",function(T,A,_){typeof _!="object"&&(b=!1)}),l.call([1],function(){S=typeof this=="string"},"x")),!!l&&b&&S};f(i,{forEach:function(l){var b=m(this),S=R&&u(this)?this.split(""):b,T=arguments[1],A=-1,_=S.length>>>0;if(!o(l))throw new TypeError;for(;++A<_;)A in S&&l.call(T,S[A],A,b)}},!p(i.forEach));var y=Array.prototype.indexOf&&[0,1].indexOf(1,2)!==-1;f(i,{indexOf:function(l){var b=R&&u(this)?this.split(""):m(this),S=b.length>>>0;if(!S)return-1;var T=0;for(arguments.length>1&&(T=E(arguments[1])),T=T>=0?T:Math.max(0,S+T);T<S;T++)if(T in b&&b[T]===l)return T;return-1}},y);var d=r.split;"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1?function(){var v=/()??/.exec("")[1]===void 0;r.split=function(l,b){var S=this;if(l===void 0&&b===0)return[];if(s.call(l)!=="[object RegExp]")return d.call(this,l,b);var T=[],A=(l.ignoreCase?"i":"")+(l.multiline?"m":"")+(l.extended?"x":"")+(l.sticky?"y":""),_=0,H,j,M,ut;for(l=new RegExp(l.source,A+"g"),S+="",v||(H=new RegExp("^"+l.source+"$(?!\\s)",A)),b=b===void 0?-1>>>0:k(b);(j=l.exec(S))&&(M=j.index+j[0].length,!(M>_&&(T.push(S.slice(_,j.index)),!v&&j.length>1&&j[0].replace(H,function(){for(var K=1;K<arguments.length-2;K++)arguments[K]===void 0&&(j[K]=void 0)}),j.length>1&&j.index<S.length&&i.push.apply(T,j.slice(1)),ut=j[0].length,_=M,T.length>=b)));)l.lastIndex===j.index&&l.lastIndex++;return _===S.length?(ut||!l.test(""))&&T.push(""):T.push(S.slice(_)),T.length>b?T.slice(0,b):T}}():"0".split(void 0,0).length&&(r.split=function(l,b){return l===void 0&&b===0?[]:d.call(this,l,b)});var g=r.substr,w="".substr&&"0b".substr(-1)!=="b";return f(r,{substr:function(l,b){return g.call(this,l<0&&(l=this.length+l)<0?0:l,b)}},w),er}var Ve,rr;function ln(){if(rr)return Ve;rr=1;var i=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,e,t=function(r){var n,s={},o=[];for(n=0;n<65536;n++)o.push(String.fromCharCode(n));return r.lastIndex=0,o.join("").replace(r,function(a){return s[a]="\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4),""}),r.lastIndex=0,s};return Ve={quote:function(r){var n=JSON.stringify(r);return i.lastIndex=0,i.test(n)?(e||(e=t(i)),n.replace(i,function(s){return e[s]})):n}},Ve}var $e,nr;function hn(){if(nr)return $e;nr=1;var i=function(){};return $e=function(e){return{filterToEnabled:function(t,r){var n={main:[],facade:[]};return t?typeof t=="string"&&(t=[t]):t=[],e.forEach(function(s){if(s&&!(s.transportName==="websocket"&&r.websocket===!1)){if(t.length&&t.indexOf(s.transportName)===-1){i("not in whitelist",s.transportName);return}s.enabled(r)?(i("enabled",s.transportName),n.main.push(s),s.facadeTransport&&n.facade.push(s.facadeTransport)):i("disabled",s.transportName)}}),n}}},$e}var Xe,ir;function dn(){if(ir)return Xe;ir=1;var i={};return["log","debug","warn"].forEach(function(e){var t;try{t=window.console&&window.console[e]&&window.console[e].apply}catch{}i[e]=t?function(){return window.console[e].apply(window.console,arguments)}:e==="log"?function(){}:i.log}),Xe=i,Xe}var Ge,sr;function ct(){if(sr)return Ge;sr=1;function i(e){this.type=e}return i.prototype.initEvent=function(e,t,r){return this.type=e,this.bubbles=t,this.cancelable=r,this.timeStamp=+new Date,this},i.prototype.stopPropagation=function(){},i.prototype.preventDefault=function(){},i.CAPTURING_PHASE=1,i.AT_TARGET=2,i.BUBBLING_PHASE=3,Ge=i,Ge}var Je,or;function Or(){return or||(or=1,Je=window.location||{origin:"http://localhost:80",protocol:"http:",host:"localhost",port:80,href:"http://localhost/",hash:""}),Je}var ze,ar;function fn(){if(ar)return ze;ar=1;var i=I(),e=ct();function t(){e.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}return i(t,e),ze=t,ze}var Ke,cr;function pn(){if(cr)return Ke;cr=1;var i=I(),e=ct();function t(r){e.call(this),this.initEvent("message",!1,!1),this.data=r}return i(t,e),Ke=t,Ke}var Qe,ur;function mn(){if(ur)return Qe;ur=1;var i=L().EventEmitter,e=I();function t(){var r=this;i.call(this),this.to=setTimeout(function(){r.emit("finish",200,"{}")},t.timeout)}return e(t,i),t.prototype.close=function(){clearTimeout(this.to)},t.timeout=2e3,Qe=t,Qe}var Ze,lr;function Nr(){if(lr)return Ze;lr=1;var i=L().EventEmitter,e=I(),t=at();function r(n,s){i.call(this);var o=this,a=+new Date;this.xo=new s("GET",n),this.xo.once("finish",function(u,h){var c,f;if(u===200){if(f=+new Date-a,h)try{c=JSON.parse(h)}catch{}t.isObject(c)||(c={})}o.emit("finish",c,f),o.removeAllListeners()})}return e(r,i),r.prototype.close=function(){this.removeAllListeners(),this.xo.close()},Ze=r,Ze}var Ye,hr;function Ar(){if(hr)return Ye;hr=1;var i=I(),e=L().EventEmitter,t=G(),r=Nr();function n(s){var o=this;e.call(this),this.ir=new r(s,t),this.ir.once("finish",function(a,u){o.ir=null,o.emit("message",JSON.stringify([a,u]))})}return i(n,e),n.transportName="iframe-info-receiver",n.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},Ye=n,Ye}var et,dr;function gn(){if(dr)return et;dr=1;var i=L().EventEmitter,e=I(),t=W(),r=Ir(),n=Ar();function s(o,a){var u=this;i.call(this);var h=function(){var c=u.ifr=new r(n.transportName,a,o);c.once("message",function(f){if(f){var m;try{m=JSON.parse(f)}catch{u.emit("finish"),u.close();return}var E=m[0],k=m[1];u.emit("finish",E,k)}u.close()}),c.once("close",function(){u.emit("finish"),u.close()})};window.document.body?h():t.attachEvent("load",h)}return e(s,i),s.enabled=function(){return r.enabled()},s.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},et=s,et}var tt,fr;function vn(){if(fr)return tt;fr=1;var i=L().EventEmitter,e=I(),t=U(),r=ot(),n=oe(),s=G(),o=mn(),a=gn(),u=Nr();function h(c,f){var m=this;i.call(this),setTimeout(function(){m.doXhr(c,f)},0)}return e(h,i),h._getReceiver=function(c,f,m){return m.sameOrigin?new u(f,s):n.enabled?new u(f,n):r.enabled&&m.sameScheme?new u(f,r):a.enabled()?new a(c,f):new u(f,o)},h.prototype.doXhr=function(c,f){var m=this,E=t.addPath(c,"/info");this.xo=h._getReceiver(c,E,f),this.timeoutRef=setTimeout(function(){m._cleanup(!1),m.emit("finish")},h.timeout),this.xo.once("finish",function(k,x){m._cleanup(!0),m.emit("finish",k,x)})},h.prototype._cleanup=function(c){clearTimeout(this.timeoutRef),this.timeoutRef=null,!c&&this.xo&&this.xo.close(),this.xo=null},h.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)},h.timeout=8e3,tt=h,tt}var rt,pr;function bn(){if(pr)return rt;pr=1;var i=z();function e(t){this._transport=t,t.on("message",this._transportMessage.bind(this)),t.on("close",this._transportClose.bind(this))}return e.prototype._transportClose=function(t,r){i.postMessage("c",JSON.stringify([t,r]))},e.prototype._transportMessage=function(t){i.postMessage("t",t)},e.prototype._send=function(t){this._transport.send(t)},e.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},rt=e,rt}var nt,mr;function yn(){if(mr)return nt;mr=1;var i=U(),e=W(),t=bn(),r=Ar(),n=z(),s=Or(),o=function(){};return nt=function(a,u){var h={};u.forEach(function(f){f.facadeTransport&&(h[f.facadeTransport.transportName]=f.facadeTransport)}),h[r.transportName]=r;var c;a.bootstrap_iframe=function(){var f;n.currentWindowId=s.hash.slice(1);var m=function(E){if(E.source===parent&&(typeof c>"u"&&(c=E.origin),E.origin===c)){var k;try{k=JSON.parse(E.data)}catch{o("bad json",E.data);return}if(k.windowId===n.currentWindowId)switch(k.type){case"s":var x;try{x=JSON.parse(k.data)}catch{o("bad json",k.data);break}var O=x[0],R=x[1],p=x[2],y=x[3];if(O!==a.version)throw new Error('Incompatible SockJS! Main site uses: "'+O+'", the iframe: "'+a.version+'".');if(!i.isOriginEqual(p,s.href)||!i.isOriginEqual(y,s.href))throw new Error("Can't connect to different domain from within an iframe. ("+s.href+", "+p+", "+y+")");f=new t(new h[R](p,y));break;case"m":f._send(k.data);break;case"c":f&&f._close(),f=null;break}}};e.attachEvent("message",m),n.postMessage("s")}},nt}var it,gr;function wn(){if(gr)return it;gr=1,un();var i=Er(),e=I(),t=F(),r=ln(),n=U(),s=W(),o=hn(),a=at(),u=J(),h=dn(),c=ct(),f=xr(),m=Or(),E=fn(),k=pn(),x=vn(),O=function(){},R;function p(d,g,w){if(!(this instanceof p))return new p(d,g,w);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");f.call(this),this.readyState=p.CONNECTING,this.extensions="",this.protocol="",w=w||{},w.protocols_whitelist&&h.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=w.transports,this._transportOptions=w.transportOptions||{},this._timeout=w.timeout||0;var v=w.sessionId||8;if(typeof v=="function")this._generateSessionId=v;else if(typeof v=="number")this._generateSessionId=function(){return t.string(v)};else throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._server=w.server||t.numberString(1e3);var l=new i(d);if(!l.host||!l.protocol)throw new SyntaxError("The URL '"+d+"' is invalid");if(l.hash)throw new SyntaxError("The URL must not contain a fragment");if(l.protocol!=="http:"&&l.protocol!=="https:")throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+l.protocol+"' is not allowed.");var b=l.protocol==="https:";if(m.protocol==="https:"&&!b&&!n.isLoopbackAddr(l.hostname))throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");g?Array.isArray(g)||(g=[g]):g=[];var S=g.sort();S.forEach(function(A,_){if(!A)throw new SyntaxError("The protocols entry '"+A+"' is invalid.");if(_<S.length-1&&A===S[_+1])throw new SyntaxError("The protocols entry '"+A+"' is duplicated.")});var T=n.getOrigin(m.href);this._origin=T?T.toLowerCase():null,l.set("pathname",l.pathname.replace(/\/+$/,"")),this.url=l.href,O("using url",this.url),this._urlInfo={nullOrigin:!u.hasDomain(),sameOrigin:n.isOriginEqual(this.url,m.href),sameScheme:n.isSchemeEqual(this.url,m.href)},this._ir=new x(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}e(p,f);function y(d){return d===1e3||d>=3e3&&d<=4999}return p.prototype.close=function(d,g){if(d&&!y(d))throw new Error("InvalidAccessError: Invalid code");if(g&&g.length>123)throw new SyntaxError("reason argument has an invalid length");if(!(this.readyState===p.CLOSING||this.readyState===p.CLOSED)){var w=!0;this._close(d||1e3,g||"Normal closure",w)}},p.prototype.send=function(d){if(typeof d!="string"&&(d=""+d),this.readyState===p.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===p.OPEN&&this._transport.send(r.quote(d))},p.version=Tr(),p.CONNECTING=0,p.OPEN=1,p.CLOSING=2,p.CLOSED=3,p.prototype._receiveInfo=function(d,g){if(this._ir=null,!d){this._close(1002,"Cannot connect to server");return}this._rto=this.countRTO(g),this._transUrl=d.base_url?d.base_url:this.url,d=a.extend(d,this._urlInfo);var w=R.filterToEnabled(this._transportsWhitelist,d);this._transports=w.main,O(this._transports.length+" enabled transports"),this._connect()},p.prototype._connect=function(){for(var d=this._transports.shift();d;d=this._transports.shift()){if(O("attempt",d.transportName),d.needBody&&(!window.document.body||typeof window.document.readyState<"u"&&window.document.readyState!=="complete"&&window.document.readyState!=="interactive")){this._transports.unshift(d),s.attachEvent("load",this._connect.bind(this));return}var g=Math.max(this._timeout,this._rto*d.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),g);var w=n.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),v=this._transportOptions[d.transportName],l=new d(w,this._transUrl,v);l.on("message",this._transportMessage.bind(this)),l.once("close",this._transportClose.bind(this)),l.transportName=d.transportName,this._transport=l;return}this._close(2e3,"All transports failed",!1)},p.prototype._transportTimeout=function(){this.readyState===p.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))},p.prototype._transportMessage=function(d){var g=this,w=d.slice(0,1),v=d.slice(1),l;switch(w){case"o":this._open();return;case"h":this.dispatchEvent(new c("heartbeat")),O("heartbeat",this.transport);return}if(v)try{l=JSON.parse(v)}catch{}if(!(typeof l>"u"))switch(w){case"a":Array.isArray(l)&&l.forEach(function(b){O("message",g.transport),g.dispatchEvent(new k(b))});break;case"m":O("message",this.transport),this.dispatchEvent(new k(l));break;case"c":Array.isArray(l)&&l.length===2&&this._close(l[0],l[1],!0);break}},p.prototype._transportClose=function(d,g){if(O("_transportClose",this.transport),this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),!y(d)&&d!==2e3&&this.readyState===p.CONNECTING){this._connect();return}this._close(d,g)},p.prototype._open=function(){O("_open",this._transport&&this._transport.transportName,this.readyState),this.readyState===p.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=p.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new c("open")),O("connected",this.transport)):this._close(1006,"Server lost session")},p.prototype._close=function(d,g,w){O("_close",this.transport,d,g,w,this.readyState);var v=!1;if(this._ir&&(v=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===p.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=p.CLOSING,setTimeout((function(){this.readyState=p.CLOSED,v&&this.dispatchEvent(new c("error"));var l=new E("close");l.wasClean=w||!1,l.code=d||1e3,l.reason=g,this.dispatchEvent(l),this.onmessage=this.onclose=this.onerror=null}).bind(this),0)},p.prototype.countRTO=function(d){return d>100?4*d:300+d},it=function(d){return R=o(d),yn()(p,d),p},it}var st,vr;function _n(){if(vr)return st;vr=1;var i=cn();return st=wn()(i),"_sockjs_onload"in window&&setTimeout(window._sockjs_onload,1),st}var En=_n();const xn=jr(En);function Sn(i,e){i.terminate=function(){const t=()=>{};this.onerror=t,this.onmessage=t,this.onopen=t;const r=new Date,n=Math.random().toString().substring(2,8),s=this.onclose;this.onclose=o=>{const a=new Date().getTime()-r.getTime();e(`Discarded socket (#${n})  closed after ${a}ms, with code/reason: ${o.code}/${o.reason}`)},this.close(),s==null||s.call(i,{code:4001,reason:`Quick discarding socket (#${n}) without waiting for the shutdown sequence.`,wasClean:!1})}}const $={LF:`
`,NULL:"\0"};class D{get body(){return!this._body&&this.isBinaryBody&&(this._body=new TextDecoder().decode(this._binaryBody)),this._body||""}get binaryBody(){return!this._binaryBody&&!this.isBinaryBody&&(this._binaryBody=new TextEncoder().encode(this._body)),this._binaryBody}constructor(e){const{command:t,headers:r,body:n,binaryBody:s,escapeHeaderValues:o,skipContentLengthHeader:a}=e;this.command=t,this.headers=Object.assign({},r||{}),s?(this._binaryBody=s,this.isBinaryBody=!0):(this._body=n||"",this.isBinaryBody=!1),this.escapeHeaderValues=o||!1,this.skipContentLengthHeader=a||!1}static fromRawFrame(e,t){const r={},n=s=>s.replace(/^\s+|\s+$/g,"");for(const s of e.headers.reverse()){s.indexOf(":");const o=n(s[0]);let a=n(s[1]);t&&e.command!=="CONNECT"&&e.command!=="CONNECTED"&&(a=D.hdrValueUnEscape(a)),r[o]=a}return new D({command:e.command,headers:r,binaryBody:e.binaryBody,escapeHeaderValues:t})}toString(){return this.serializeCmdAndHeaders()}serialize(){const e=this.serializeCmdAndHeaders();return this.isBinaryBody?D.toUnit8Array(e,this._binaryBody).buffer:e+this._body+$.NULL}serializeCmdAndHeaders(){const e=[this.command];this.skipContentLengthHeader&&delete this.headers["content-length"];for(const t of Object.keys(this.headers||{})){const r=this.headers[t];this.escapeHeaderValues&&this.command!=="CONNECT"&&this.command!=="CONNECTED"?e.push(`${t}:${D.hdrValueEscape(`${r}`)}`):e.push(`${t}:${r}`)}return(this.isBinaryBody||!this.isBodyEmpty()&&!this.skipContentLengthHeader)&&e.push(`content-length:${this.bodyLength()}`),e.join($.LF)+$.LF+$.LF}isBodyEmpty(){return this.bodyLength()===0}bodyLength(){const e=this.binaryBody;return e?e.length:0}static sizeOfUTF8(e){return e?new TextEncoder().encode(e).length:0}static toUnit8Array(e,t){const r=new TextEncoder().encode(e),n=new Uint8Array([0]),s=new Uint8Array(r.length+t.length+n.length);return s.set(r),s.set(t,r.length),s.set(n,r.length+t.length),s}static marshall(e){return new D(e).serialize()}static hdrValueEscape(e){return e.replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")}static hdrValueUnEscape(e){return e.replace(/\\r/g,"\r").replace(/\\n/g,`
`).replace(/\\c/g,":").replace(/\\\\/g,"\\")}}const br=0,re=10,ne=13,Cn=58;class kn{constructor(e,t){this.onFrame=e,this.onIncomingPing=t,this._encoder=new TextEncoder,this._decoder=new TextDecoder,this._token=[],this._initState()}parseChunk(e,t=!1){let r;if(typeof e=="string"?r=this._encoder.encode(e):r=new Uint8Array(e),t&&r[r.length-1]!==0){const n=new Uint8Array(r.length+1);n.set(r,0),n[r.length]=0,r=n}for(let n=0;n<r.length;n++){const s=r[n];this._onByte(s)}}_collectFrame(e){if(e!==br&&e!==ne){if(e===re){this.onIncomingPing();return}this._onByte=this._collectCommand,this._reinjectByte(e)}}_collectCommand(e){if(e!==ne){if(e===re){this._results.command=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaders;return}this._consumeByte(e)}}_collectHeaders(e){if(e!==ne){if(e===re){this._setupCollectBody();return}this._onByte=this._collectHeaderKey,this._reinjectByte(e)}}_reinjectByte(e){this._onByte(e)}_collectHeaderKey(e){if(e===Cn){this._headerKey=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaderValue;return}this._consumeByte(e)}_collectHeaderValue(e){if(e!==ne){if(e===re){this._results.headers.push([this._headerKey,this._consumeTokenAsUTF8()]),this._headerKey=void 0,this._onByte=this._collectHeaders;return}this._consumeByte(e)}}_setupCollectBody(){const e=this._results.headers.filter(t=>t[0]==="content-length")[0];e?(this._bodyBytesRemaining=parseInt(e[1],10),this._onByte=this._collectBodyFixedSize):this._onByte=this._collectBodyNullTerminated}_collectBodyNullTerminated(e){if(e===br){this._retrievedBody();return}this._consumeByte(e)}_collectBodyFixedSize(e){if(this._bodyBytesRemaining--===0){this._retrievedBody();return}this._consumeByte(e)}_retrievedBody(){this._results.binaryBody=this._consumeTokenAsRaw();try{this.onFrame(this._results)}catch(e){console.log("Ignoring an exception thrown by a frame handler. Original exception: ",e)}this._initState()}_consumeByte(e){this._token.push(e)}_consumeTokenAsUTF8(){return this._decoder.decode(this._consumeTokenAsRaw())}_consumeTokenAsRaw(){const e=new Uint8Array(this._token);return this._token=[],e}_initState(){this._results={command:void 0,headers:[],binaryBody:void 0},this._token=[],this._headerKey=void 0,this._onByte=this._collectFrame}}var P;(function(i){i[i.CONNECTING=0]="CONNECTING",i[i.OPEN=1]="OPEN",i[i.CLOSING=2]="CLOSING",i[i.CLOSED=3]="CLOSED"})(P||(P={}));var B;(function(i){i[i.ACTIVE=0]="ACTIVE",i[i.DEACTIVATING=1]="DEACTIVATING",i[i.INACTIVE=2]="INACTIVE"})(B||(B={}));var ie;(function(i){i[i.LINEAR=0]="LINEAR",i[i.EXPONENTIAL=1]="EXPONENTIAL"})(ie||(ie={}));var X;(function(i){i.Interval="interval",i.Worker="worker"})(X||(X={}));class Rn{constructor(e,t=X.Interval,r){this._interval=e,this._strategy=t,this._debug=r,this._workerScript=`
    var startTime = Date.now();
    setInterval(function() {
        self.postMessage(Date.now() - startTime);
    }, ${this._interval});
  `}start(e){this.stop(),this.shouldUseWorker()?this.runWorker(e):this.runInterval(e)}stop(){this.disposeWorker(),this.disposeInterval()}shouldUseWorker(){return typeof Worker<"u"&&this._strategy===X.Worker}runWorker(e){this._debug("Using runWorker for outgoing pings"),this._worker||(this._worker=new Worker(URL.createObjectURL(new Blob([this._workerScript],{type:"text/javascript"}))),this._worker.onmessage=t=>e(t.data))}runInterval(e){if(this._debug("Using runInterval for outgoing pings"),!this._timer){const t=Date.now();this._timer=setInterval(()=>{e(Date.now()-t)},this._interval)}}disposeWorker(){this._worker&&(this._worker.terminate(),delete this._worker,this._debug("Outgoing ping disposeWorker"))}disposeInterval(){this._timer&&(clearInterval(this._timer),delete this._timer,this._debug("Outgoing ping disposeInterval"))}}class q{constructor(e){this.versions=e}supportedVersions(){return this.versions.join(",")}protocolVersions(){return this.versions.map(e=>`v${e.replace(".","")}.stomp`)}}q.V1_0="1.0";q.V1_1="1.1";q.V1_2="1.2";q.default=new q([q.V1_2,q.V1_1,q.V1_0]);class Tn{get connectedVersion(){return this._connectedVersion}get connected(){return this._connected}constructor(e,t,r){this._client=e,this._webSocket=t,this._connected=!1,this._serverFrameHandlers={CONNECTED:n=>{this.debug(`connected to server ${n.headers.server}`),this._connected=!0,this._connectedVersion=n.headers.version,this._connectedVersion===q.V1_2&&(this._escapeHeaderValues=!0),this._setupHeartbeat(n.headers),this.onConnect(n)},MESSAGE:n=>{const s=n.headers.subscription,o=this._subscriptions[s]||this.onUnhandledMessage,a=n,u=this,h=this._connectedVersion===q.V1_2?a.headers.ack:a.headers["message-id"];a.ack=(c={})=>u.ack(h,s,c),a.nack=(c={})=>u.nack(h,s,c),o(a)},RECEIPT:n=>{const s=this._receiptWatchers[n.headers["receipt-id"]];s?(s(n),delete this._receiptWatchers[n.headers["receipt-id"]]):this.onUnhandledReceipt(n)},ERROR:n=>{this.onStompError(n)}},this._counter=0,this._subscriptions={},this._receiptWatchers={},this._partialData="",this._escapeHeaderValues=!1,this._lastServerActivityTS=Date.now(),this.debug=r.debug,this.stompVersions=r.stompVersions,this.connectHeaders=r.connectHeaders,this.disconnectHeaders=r.disconnectHeaders,this.heartbeatIncoming=r.heartbeatIncoming,this.heartbeatOutgoing=r.heartbeatOutgoing,this.splitLargeFrames=r.splitLargeFrames,this.maxWebSocketChunkSize=r.maxWebSocketChunkSize,this.forceBinaryWSFrames=r.forceBinaryWSFrames,this.logRawCommunication=r.logRawCommunication,this.appendMissingNULLonIncoming=r.appendMissingNULLonIncoming,this.discardWebsocketOnCommFailure=r.discardWebsocketOnCommFailure,this.onConnect=r.onConnect,this.onDisconnect=r.onDisconnect,this.onStompError=r.onStompError,this.onWebSocketClose=r.onWebSocketClose,this.onWebSocketError=r.onWebSocketError,this.onUnhandledMessage=r.onUnhandledMessage,this.onUnhandledReceipt=r.onUnhandledReceipt,this.onUnhandledFrame=r.onUnhandledFrame}start(){const e=new kn(t=>{const r=D.fromRawFrame(t,this._escapeHeaderValues);this.logRawCommunication||this.debug(`<<< ${r}`),(this._serverFrameHandlers[r.command]||this.onUnhandledFrame)(r)},()=>{this.debug("<<< PONG")});this._webSocket.onmessage=t=>{if(this.debug("Received data"),this._lastServerActivityTS=Date.now(),this.logRawCommunication){const r=t.data instanceof ArrayBuffer?new TextDecoder().decode(t.data):t.data;this.debug(`<<< ${r}`)}e.parseChunk(t.data,this.appendMissingNULLonIncoming)},this._webSocket.onclose=t=>{this.debug(`Connection closed to ${this._webSocket.url}`),this._cleanUp(),this.onWebSocketClose(t)},this._webSocket.onerror=t=>{this.onWebSocketError(t)},this._webSocket.onopen=()=>{const t=Object.assign({},this.connectHeaders);this.debug("Web Socket Opened..."),t["accept-version"]=this.stompVersions.supportedVersions(),t["heart-beat"]=[this.heartbeatOutgoing,this.heartbeatIncoming].join(","),this._transmit({command:"CONNECT",headers:t})}}_setupHeartbeat(e){if(e.version!==q.V1_1&&e.version!==q.V1_2||!e["heart-beat"])return;const[t,r]=e["heart-beat"].split(",").map(n=>parseInt(n,10));if(this.heartbeatOutgoing!==0&&r!==0){const n=Math.max(this.heartbeatOutgoing,r);this.debug(`send PING every ${n}ms`),this._pinger=new Rn(n,this._client.heartbeatStrategy,this.debug),this._pinger.start(()=>{this._webSocket.readyState===P.OPEN&&(this._webSocket.send($.LF),this.debug(">>> PING"))})}if(this.heartbeatIncoming!==0&&t!==0){const n=Math.max(this.heartbeatIncoming,t);this.debug(`check PONG every ${n}ms`),this._ponger=setInterval(()=>{const s=Date.now()-this._lastServerActivityTS;s>n*2&&(this.debug(`did not receive server activity for the last ${s}ms`),this._closeOrDiscardWebsocket())},n)}}_closeOrDiscardWebsocket(){this.discardWebsocketOnCommFailure?(this.debug("Discarding websocket, the underlying socket may linger for a while"),this.discardWebsocket()):(this.debug("Issuing close on the websocket"),this._closeWebsocket())}forceDisconnect(){this._webSocket&&(this._webSocket.readyState===P.CONNECTING||this._webSocket.readyState===P.OPEN)&&this._closeOrDiscardWebsocket()}_closeWebsocket(){this._webSocket.onmessage=()=>{},this._webSocket.close()}discardWebsocket(){typeof this._webSocket.terminate!="function"&&Sn(this._webSocket,e=>this.debug(e)),this._webSocket.terminate()}_transmit(e){const{command:t,headers:r,body:n,binaryBody:s,skipContentLengthHeader:o}=e,a=new D({command:t,headers:r,body:n,binaryBody:s,escapeHeaderValues:this._escapeHeaderValues,skipContentLengthHeader:o});let u=a.serialize();if(this.logRawCommunication?this.debug(`>>> ${u}`):this.debug(`>>> ${a}`),this.forceBinaryWSFrames&&typeof u=="string"&&(u=new TextEncoder().encode(u)),typeof u!="string"||!this.splitLargeFrames)this._webSocket.send(u);else{let h=u;for(;h.length>0;){const c=h.substring(0,this.maxWebSocketChunkSize);h=h.substring(this.maxWebSocketChunkSize),this._webSocket.send(c),this.debug(`chunk sent = ${c.length}, remaining = ${h.length}`)}}}dispose(){if(this.connected)try{const e=Object.assign({},this.disconnectHeaders);e.receipt||(e.receipt=`close-${this._counter++}`),this.watchForReceipt(e.receipt,t=>{this._closeWebsocket(),this._cleanUp(),this.onDisconnect(t)}),this._transmit({command:"DISCONNECT",headers:e})}catch(e){this.debug(`Ignoring error during disconnect ${e}`)}else(this._webSocket.readyState===P.CONNECTING||this._webSocket.readyState===P.OPEN)&&this._closeWebsocket()}_cleanUp(){this._connected=!1,this._pinger&&(this._pinger.stop(),this._pinger=void 0),this._ponger&&(clearInterval(this._ponger),this._ponger=void 0)}publish(e){const{destination:t,headers:r,body:n,binaryBody:s,skipContentLengthHeader:o}=e,a=Object.assign({destination:t},r);this._transmit({command:"SEND",headers:a,body:n,binaryBody:s,skipContentLengthHeader:o})}watchForReceipt(e,t){this._receiptWatchers[e]=t}subscribe(e,t,r={}){r=Object.assign({},r),r.id||(r.id=`sub-${this._counter++}`),r.destination=e,this._subscriptions[r.id]=t,this._transmit({command:"SUBSCRIBE",headers:r});const n=this;return{id:r.id,unsubscribe(s){return n.unsubscribe(r.id,s)}}}unsubscribe(e,t={}){t=Object.assign({},t),delete this._subscriptions[e],t.id=e,this._transmit({command:"UNSUBSCRIBE",headers:t})}begin(e){const t=e||`tx-${this._counter++}`;this._transmit({command:"BEGIN",headers:{transaction:t}});const r=this;return{id:t,commit(){r.commit(t)},abort(){r.abort(t)}}}commit(e){this._transmit({command:"COMMIT",headers:{transaction:e}})}abort(e){this._transmit({command:"ABORT",headers:{transaction:e}})}ack(e,t,r={}){r=Object.assign({},r),this._connectedVersion===q.V1_2?r.id=e:r["message-id"]=e,r.subscription=t,this._transmit({command:"ACK",headers:r})}nack(e,t,r={}){return r=Object.assign({},r),this._connectedVersion===q.V1_2?r.id=e:r["message-id"]=e,r.subscription=t,this._transmit({command:"NACK",headers:r})}}class In{get webSocket(){var e;return(e=this._stompHandler)==null?void 0:e._webSocket}get disconnectHeaders(){return this._disconnectHeaders}set disconnectHeaders(e){this._disconnectHeaders=e,this._stompHandler&&(this._stompHandler.disconnectHeaders=this._disconnectHeaders)}get connected(){return!!this._stompHandler&&this._stompHandler.connected}get connectedVersion(){return this._stompHandler?this._stompHandler.connectedVersion:void 0}get active(){return this.state===B.ACTIVE}_changeState(e){this.state=e,this.onChangeState(e)}constructor(e={}){this.stompVersions=q.default,this.connectionTimeout=0,this.reconnectDelay=5e3,this._nextReconnectDelay=0,this.maxReconnectDelay=15*60*1e3,this.reconnectTimeMode=ie.LINEAR,this.heartbeatIncoming=1e4,this.heartbeatOutgoing=1e4,this.heartbeatStrategy=X.Interval,this.splitLargeFrames=!1,this.maxWebSocketChunkSize=8*1024,this.forceBinaryWSFrames=!1,this.appendMissingNULLonIncoming=!1,this.discardWebsocketOnCommFailure=!1,this.state=B.INACTIVE;const t=()=>{};this.debug=t,this.beforeConnect=t,this.onConnect=t,this.onDisconnect=t,this.onUnhandledMessage=t,this.onUnhandledReceipt=t,this.onUnhandledFrame=t,this.onStompError=t,this.onWebSocketClose=t,this.onWebSocketError=t,this.logRawCommunication=!1,this.onChangeState=t,this.connectHeaders={},this._disconnectHeaders={},this.configure(e)}configure(e){Object.assign(this,e),this.maxReconnectDelay>0&&this.maxReconnectDelay<this.reconnectDelay&&(this.debug(`Warning: maxReconnectDelay (${this.maxReconnectDelay}ms) is less than reconnectDelay (${this.reconnectDelay}ms). Using reconnectDelay as the maxReconnectDelay delay.`),this.maxReconnectDelay=this.reconnectDelay)}activate(){const e=()=>{if(this.active){this.debug("Already ACTIVE, ignoring request to activate");return}this._changeState(B.ACTIVE),this._nextReconnectDelay=this.reconnectDelay,this._connect()};this.state===B.DEACTIVATING?(this.debug("Waiting for deactivation to finish before activating"),this.deactivate().then(()=>{e()})):e()}async _connect(){if(await this.beforeConnect(this),this._stompHandler){this.debug("There is already a stompHandler, skipping the call to connect");return}if(!this.active){this.debug("Client has been marked inactive, will not attempt to connect");return}this.connectionTimeout>0&&(this._connectionWatcher&&clearTimeout(this._connectionWatcher),this._connectionWatcher=setTimeout(()=>{this.connected||(this.debug(`Connection not established in ${this.connectionTimeout}ms, closing socket`),this.forceDisconnect())},this.connectionTimeout)),this.debug("Opening Web Socket...");const e=this._createWebSocket();this._stompHandler=new Tn(this,e,{debug:this.debug,stompVersions:this.stompVersions,connectHeaders:this.connectHeaders,disconnectHeaders:this._disconnectHeaders,heartbeatIncoming:this.heartbeatIncoming,heartbeatOutgoing:this.heartbeatOutgoing,heartbeatStrategy:this.heartbeatStrategy,splitLargeFrames:this.splitLargeFrames,maxWebSocketChunkSize:this.maxWebSocketChunkSize,forceBinaryWSFrames:this.forceBinaryWSFrames,logRawCommunication:this.logRawCommunication,appendMissingNULLonIncoming:this.appendMissingNULLonIncoming,discardWebsocketOnCommFailure:this.discardWebsocketOnCommFailure,onConnect:t=>{if(this._connectionWatcher&&(clearTimeout(this._connectionWatcher),this._connectionWatcher=void 0),!this.active){this.debug("STOMP got connected while deactivate was issued, will disconnect now"),this._disposeStompHandler();return}this.onConnect(t)},onDisconnect:t=>{this.onDisconnect(t)},onStompError:t=>{this.onStompError(t)},onWebSocketClose:t=>{this._stompHandler=void 0,this.state===B.DEACTIVATING&&this._changeState(B.INACTIVE),this.onWebSocketClose(t),this.active&&this._schedule_reconnect()},onWebSocketError:t=>{this.onWebSocketError(t)},onUnhandledMessage:t=>{this.onUnhandledMessage(t)},onUnhandledReceipt:t=>{this.onUnhandledReceipt(t)},onUnhandledFrame:t=>{this.onUnhandledFrame(t)}}),this._stompHandler.start()}_createWebSocket(){let e;if(this.webSocketFactory)e=this.webSocketFactory();else if(this.brokerURL)e=new WebSocket(this.brokerURL,this.stompVersions.protocolVersions());else throw new Error("Either brokerURL or webSocketFactory must be provided");return e.binaryType="arraybuffer",e}_schedule_reconnect(){this._nextReconnectDelay>0&&(this.debug(`STOMP: scheduling reconnection in ${this._nextReconnectDelay}ms`),this._reconnector=setTimeout(()=>{this.reconnectTimeMode===ie.EXPONENTIAL&&(this._nextReconnectDelay=this._nextReconnectDelay*2,this.maxReconnectDelay!==0&&(this._nextReconnectDelay=Math.min(this._nextReconnectDelay,this.maxReconnectDelay))),this._connect()},this._nextReconnectDelay))}async deactivate(e={}){var s;const t=e.force||!1,r=this.active;let n;if(this.state===B.INACTIVE)return this.debug("Already INACTIVE, nothing more to do"),Promise.resolve();if(this._changeState(B.DEACTIVATING),this._nextReconnectDelay=0,this._reconnector&&(clearTimeout(this._reconnector),this._reconnector=void 0),this._stompHandler&&this.webSocket.readyState!==P.CLOSED){const o=this._stompHandler.onWebSocketClose;n=new Promise((a,u)=>{this._stompHandler.onWebSocketClose=h=>{o(h),a()}})}else return this._changeState(B.INACTIVE),Promise.resolve();return t?(s=this._stompHandler)==null||s.discardWebsocket():r&&this._disposeStompHandler(),n}forceDisconnect(){this._stompHandler&&this._stompHandler.forceDisconnect()}_disposeStompHandler(){this._stompHandler&&this._stompHandler.dispose()}publish(e){this._checkConnection(),this._stompHandler.publish(e)}_checkConnection(){if(!this.connected)throw new TypeError("There is no underlying STOMP connection")}watchForReceipt(e,t){this._checkConnection(),this._stompHandler.watchForReceipt(e,t)}subscribe(e,t,r={}){return this._checkConnection(),this._stompHandler.subscribe(e,t,r)}unsubscribe(e,t={}){this._checkConnection(),this._stompHandler.unsubscribe(e,t)}begin(e){return this._checkConnection(),this._stompHandler.begin(e)}commit(e){this._checkConnection(),this._stompHandler.commit(e)}abort(e){this._checkConnection(),this._stompHandler.abort(e)}ack(e,t,r={}){this._checkConnection(),this._stompHandler.ack(e,t,r)}nack(e,t,r={}){this._checkConnection(),this._stompHandler.nack(e,t,r)}}const{MESSAGE_PER_PAGE:On}=Dr,Bn=()=>{const{userInfo:i}=yr(w=>w.auth),e=N.useRef(null),t=N.useRef(null),[r,n]=N.useState([]),s=N.useRef(null),[o,a]=N.useState(null),[u,h]=N.useState(!1),{conversations:c,loading:f,fetchCustomerConversations:m}=Vr(),{messages:E,loading:k,pagination:x,fetchMessages:O}=Xr(),R=N.useCallback(()=>{if(t.current){const w=t.current;w.scrollTo({top:w.scrollHeight,behavior:"smooth"})}},[]),p=N.useCallback(w=>{if(w.userId===(i==null?void 0:i.id))return;const v={...w,id:w.id||crypto.randomUUID(),role:w.userId===(i==null?void 0:i.id)?"user":"admin",createdAt:new Date().toISOString()};n(l=>[...l,v]),setTimeout(R,100)},[i==null?void 0:i.id,R]),y=N.useCallback(()=>{if(!o||!(i!=null&&i.id)||u)return;const w=new xn(qr),v=new In({webSocketFactory:()=>w,reconnectDelay:5e3,heartbeatIncoming:4e3,heartbeatOutgoing:4e3});return v.onConnect=()=>{h(!0),v.subscribe(`/topic/conversation/${o}`,l=>{const b=JSON.parse(l.body);p(b),setTimeout(R,100)})},v.onStompError=()=>{h(!1)},v.onDisconnect=()=>{h(!1)},v.activate(),s.current=v,()=>{v.connected&&v.deactivate()}},[o,i==null?void 0:i.id,u,R]);N.useEffect(()=>{i!=null&&i.id&&m(i.id)},[i==null?void 0:i.id]),N.useEffect(()=>{(c==null?void 0:c.length)>0&&!o&&a(c[0].id)},[c,o]),N.useEffect(()=>{(async()=>{o&&(await O(o,0,On,["createdAt,desc"]),y())})()},[o]),N.useEffect(()=>{E.length>0&&!k&&setTimeout(R,100)},[E.length,k,R]),N.useEffect(()=>{r.length>0&&setTimeout(R,100)},[r.length,R]),N.useEffect(()=>()=>{s.current&&s.current.connected&&s.current.deactivate()},[]);const d=async w=>{var l;if(!w.trim()||!o||!(i!=null&&i.id)||!((l=s.current)!=null&&l.connected))return;const v={content:w,userId:i.id,conversationId:o,messageType:"TEXT",createdAt:new Date().toISOString(),role:"user",createdBy:i.id,id:crypto.randomUUID()};n(b=>[...b,v]);try{s.current.publish({destination:`/app/chat.sendMessage/${o}`,body:JSON.stringify(v)})}catch(b){Lr("Failed to send message"+b),O(o,0,x.size,["createdAt,desc"])}};N.useEffect(()=>{n(w=>w.filter(v=>!E.some(l=>l.content===v.content&&l.createdAt===v.createdAt&&l.userId===v.userId)))},[E]);const g=[...E,...r].sort((w,v)=>new Date(w.createdAt).getTime()-new Date(v.createdAt).getTime());return C.jsxs("div",{className:"flex mt-10 px-8 py-8 flex-col h-screen bg-gray-50 bg-white text-gray-800 overflow-hidden",children:[C.jsx(Ur,{items:[{label:Q("breadcrumb.home"),path:"/"},{label:Q("breadcrumb.chat"),path:"/chat"}]}),f&&!c.length?C.jsx("div",{className:"flex-1 flex items-center justify-center",children:C.jsx(lt,{})}):c.length===0?C.jsx("div",{className:"flex-1 flex items-center justify-center",children:C.jsxs("div",{className:"text-center",children:[C.jsx("h2",{className:"text-xl font-semibold mb-2",children:Q("msg.noConversations")}),C.jsx("p",{className:"text-gray-500",children:Q("msg.startNewConversation")})]})}):C.jsxs(C.Fragment,{children:[C.jsxs("div",{ref:t,className:"flex-1 overflow-y-auto relative",children:[k&&x.page>0&&C.jsx("div",{className:"sticky top-0 w-full bg-gray-100 p-2 text-center",children:C.jsx(lt,{})}),C.jsx(_r,{messages:g.map(w=>({...w,role:w.userId===(i==null?void 0:i.id)?"user":"admin"})),messagesEndRef:e})]}),C.jsx(Mr,{onSendMessage:d})]})]})};export{Bn as default};
