import{j as e,t as s,k as F,r as b,u as E,i,B as q,h as I}from"./index-D36DP4Cg.js";import{c as k}from"./common-Cbvgc8aE.js";import{f}from"./string-msUNxrnf.js";import{G as T}from"./Button-BE6DaCYA.js";import{B as A}from"./Breadcrumb-GPzO_xeS.js";import{u as D,a as O}from"./vn-pay-checkout-CmJX9zQv.js";import{u as $,E as _}from"./App-D_PDcBzx.js";import"./button-D7adVTLw.js";const{PAYMENT_METHOD:B}=k,Y=({formData:n,onInputChange:c,onPaymentMethodChange:m,onSubmit:u})=>e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:s("lbl.shippingInformation")}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:s("lbl.receiverName")}),e.jsx("input",{type:"text",id:"name",name:"name",value:n.name,onChange:c,className:"w-full p-3 border border-gray-300 rounded-[12px] focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:s("lbl.receiverPhone")}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:n.phone,onChange:c,className:"w-full p-3 border border-gray-300 rounded-[12px] focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 mb-1",children:s("lbl.receiverAddress")}),e.jsx("input",{type:"text",id:"address",name:"address",value:n.address,onChange:c,className:"w-full p-3 border border-gray-300 rounded-[12px] focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:s("lbl.paymentMethod")}),e.jsx("div",{className:"space-y-3",children:B.map(l=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:l.id,name:"paymentMethod",value:l.id,checked:n.paymentMethod===l.id,onChange:()=>m(l.id),className:"h-5 w-5 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:l.id,className:"ml-3 text-base font-medium text-gray-700",children:l.label})]},l.id))})]})]}),z=({items:n,summary:c,handlePayment:m,loading:u})=>{var p;const{subtotal:l,deliveryFee:y,total:x}=c,{settings:j}=F(),d=((p=j.find(t=>t.key==="CurrencyCode"))==null?void 0:p.value)||"VND";return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-6",children:s("lbl.orderSummary")}),e.jsx("div",{className:"divide-y divide-gray-200",children:n.map(t=>e.jsxs("div",{className:"py-4 flex",children:[e.jsx("div",{className:"h-20 w-20 flex-shrink-0 overflow-hidden rounded-md border border-gray-200",children:e.jsx("img",{src:t.product.mainImageUrl,alt:t.product.name,className:"h-full w-full object-cover object-center"})}),e.jsx("div",{className:"ml-4 flex flex-1 flex-col",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-base font-medium text-gray-900",children:[e.jsx("h3",{children:t.product.name}),e.jsx("p",{className:"ml-4",children:f(t.product.price*(100-t.product.discountPercent)/100*t.quantity,d)})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:`${s("lbl.quantity")}: ${t.quantity}`}),t.color&&e.jsxs("p",{className:"mt-1 text-sm text-gray-500 flex items-center",children:[s("lbl.color"),":"," ",e.jsx("span",{className:"ml-1 inline-block w-3 h-3 rounded-full",style:{backgroundColor:t.color}})]}),t.size&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:`${s("lbl.size")}: ${t.size}`})]})})]},t.id))}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("p",{className:"text-gray-600",children:s("lbl.subTotal")}),e.jsx("p",{className:"font-medium",children:f(l,d)})]}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("p",{className:"text-gray-600",children:s("lbl.deliveryFee")}),e.jsx("p",{className:"font-medium",children:f(y,d)})]}),e.jsxs("div",{className:"flex justify-between text-base font-medium mt-4",children:[e.jsx("p",{children:s("lbl.total")}),e.jsx("p",{children:f(x,d)})]})]}),e.jsx(T,{type:"submit",isLoading:u,onClick:m,className:"w-full mt-6 bg-black text-white py-4 px-6 rounded-full font-medium hover:bg-gray-800 transition-colors",children:s("lbl.makePayment")})]})},{PAYMENT_METHOD:H}=k;function W(){const n=$(),c=_(),{loading:m,performCheckout:u}=D(),{createPayment:l,loading:y}=O(),[x,j]=b.useState([]),[d,p]=b.useState({subtotal:0,deliveryFee:0,total:0}),{userInfo:t}=E(a=>a.auth),[r,g]=b.useState({name:"",phone:"",address:"",paymentMethod:""});b.useEffect(()=>{const a=n.state;if(!a||!a.selectedCartItems||a.selectedCartItems.length===0){c("/cart");return}j(a.selectedCartItems),p(a.orderSummary)},[n,c]);const w=a=>{const{name:o,value:N}=a.target;g({...r,[o]:N})},C=a=>{g({...r,paymentMethod:a})},M=()=>{if(!r.name.trim())return i(s("checkout.nameRequired")),!1;const a=/^[0-9]{9,11}$/;return!r.phone.trim()||!a.test(r.phone.trim())?(i(s("checkout.invalidPhone")),!1):r.address.trim()?r.paymentMethod?!0:(i(s("checkout.selectPaymentMethod")),!1):(i(s("checkout.addressRequired")),!1)},P=async a=>{const o=await u(a);o!=null&&o.isSuccess?(I(s("checkout.orderSuccess")),c("/order-confirmation",{state:{order:o.data}})):i(s("checkout.orderFailed"))},v=async()=>{if(!M())return;const a=r.name.trim().split(" "),o=a.pop()||"",N=a.join(" ")||o,S=x.map(h=>({itemId:h.itemId,quantity:h.quantity}));try{const h={firstName:N,lastName:o,phoneNumber:r.phone.trim(),address:r.address.trim(),paymentMethod:r.paymentMethod,orderDetails:S,customerId:(t==null?void 0:t.id)||""};r.paymentMethod===H[0].id?await P(h):r.paymentMethod==="VN_PAY"?await l(h,!0):i(s("checkout.invalidPaymentMethod"))}catch{q.error(s("checkout.orderFailed"))}};return e.jsx("div",{className:"min-h-screen mt-10 mx-8 bg-white",children:e.jsxs("div",{className:"mx-auto px-4 py-8",children:[e.jsx(A,{items:[{label:s("breadcrumb.home"),path:"/"},{label:s("breadcrumb.cart"),path:"/cart"},{label:s("breadcrumb.checkout"),path:"/checkout"}]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsx("div",{className:"w-full lg:w-1/2",children:e.jsx(Y,{formData:r,onInputChange:w,onPaymentMethodChange:C,onSubmit:v})}),e.jsx("div",{className:"w-full lg:w-1/2",children:e.jsx("div",{className:"bg-gray-100 rounded-[12px] p-6",children:e.jsx(z,{items:x,summary:d,handlePayment:v,loading:m||y})})})]})]})})}export{W as default};
