import{j as e,t as s,m as S,r as p,u as M,i as F,k as m,B as P}from"./index-CMKLkvCJ.js";import{c as q}from"./common-BnKALm7p.js";import{f as b}from"./string-msUNxrnf.js";import{G as I}from"./Button-Cnl6MZDm.js";import{B as E}from"./Breadcrumb-C24zk-tg.js";import{u as $}from"./order-DcfYe0UJ.js";import{u as B,E as z}from"./App-unIg4MgN.js";import"./button-B5BnE8Td.js";const{PAYMENT_METHOD:A}=q,D=({formData:n,onInputChange:c,onPaymentMethodChange:d,onSubmit:i})=>e.jsxs("form",{onSubmit:i,children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:s("lbl.shippingInformation")}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:s("lbl.receiverName")}),e.jsx("input",{type:"text",id:"name",name:"name",value:n.name,onChange:c,className:"w-full p-3 border border-gray-300 rounded-[12px] focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:s("lbl.receiverPhone")}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:n.phone,onChange:c,className:"w-full p-3 border border-gray-300 rounded-[12px] focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 mb-1",children:s("lbl.receiverAddress")}),e.jsx("input",{type:"text",id:"address",name:"address",value:n.address,onChange:c,className:"w-full p-3 border border-gray-300 rounded-[12px] focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:s("lbl.paymentMethod")}),e.jsx("div",{className:"space-y-3",children:A.map(l=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:l.id,name:"paymentMethod",value:l.id,checked:n.paymentMethod===l.id,onChange:()=>d(l.id),className:"h-5 w-5 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:l.id,className:"ml-3 text-base font-medium text-gray-700",children:l.label})]},l.id))})]})]}),O=({items:n,summary:c,handlePayment:d,loading:i})=>{var r;const{subtotal:l,deliveryFee:f,total:y}=c,{settings:j}=S(),o=((r=j.find(t=>t.key==="CurrencyCode"))==null?void 0:r.value)||"VND";return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-6",children:s("lbl.orderSummary")}),e.jsx("div",{className:"divide-y divide-gray-200",children:n.map(t=>e.jsxs("div",{className:"py-4 flex",children:[e.jsx("div",{className:"h-20 w-20 flex-shrink-0 overflow-hidden rounded-md border border-gray-200",children:e.jsx("img",{src:t.product.mainImageUrl,alt:t.product.name,className:"h-full w-full object-cover object-center"})}),e.jsx("div",{className:"ml-4 flex flex-1 flex-col",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-base font-medium text-gray-900",children:[e.jsx("h3",{children:t.product.name}),e.jsx("p",{className:"ml-4",children:b(t.product.price*(100-t.product.discountPercent)/100*t.quantity,o)})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:`${s("lbl.quantity")}: ${t.quantity}`}),t.color&&e.jsxs("p",{className:"mt-1 text-sm text-gray-500 flex items-center",children:[s("lbl.color"),":"," ",e.jsx("span",{className:"ml-1 inline-block w-3 h-3 rounded-full",style:{backgroundColor:t.color}})]}),t.size&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:`${s("lbl.size")}: ${t.size}`})]})})]},t.id))}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("p",{className:"text-gray-600",children:s("lbl.subTotal")}),e.jsx("p",{className:"font-medium",children:b(l,o)})]}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("p",{className:"text-gray-600",children:s("lbl.deliveryFee")}),e.jsx("p",{className:"font-medium",children:b(f,o)})]}),e.jsxs("div",{className:"flex justify-between text-base font-medium mt-4",children:[e.jsx("p",{children:s("lbl.total")}),e.jsx("p",{children:b(y,o)})]})]}),e.jsx(I,{type:"submit",isLoading:i,onClick:d,className:"w-full mt-6 bg-black text-white py-4 px-6 rounded-full font-medium hover:bg-gray-800 transition-colors",children:s("lbl.makePayment")})]})};function _(){const n=B(),c=z(),{loading:d,performCheckout:i}=$(),[l,f]=p.useState([]),[y,j]=p.useState({subtotal:0,deliveryFee:0,total:0}),{userInfo:o}=M(a=>a.auth),[r,t]=p.useState({name:"",phone:"",address:"",paymentMethod:""});p.useEffect(()=>{const a=n.state;if(!a||!a.selectedCartItems||a.selectedCartItems.length===0){c("/cart");return}f(a.selectedCartItems),j(a.orderSummary)},[n,c]);const v=a=>{const{name:u,value:g}=a.target;t({...r,[u]:g})},k=a=>{t({...r,paymentMethod:a})},w=()=>{if(!r.name.trim())return m(s("checkout.validation.nameRequired")),!1;const a=/^[0-9]{9,11}$/;return!r.phone.trim()||!a.test(r.phone.trim())?(m(s("checkout.validation.invalidPhone")),!1):r.address.trim()?r.paymentMethod?!0:(m(s("checkout.validation.selectPaymentMethod")),!1):(m(s("checkout.validation.addressRequired")),!1)},N=async()=>{if(!w())return;const a=r.name.trim().split(" "),u=a.pop()||"",g=a.join(" ")||u,C=l.map(h=>({itemId:h.itemId,quantity:h.quantity}));try{const h={firstName:g,lastName:u,phoneNumber:r.phone.trim(),address:r.address.trim(),paymentMethod:r.paymentMethod,orderDetails:C,customerId:(o==null?void 0:o.id)||""},x=await i(h);x!=null&&x.isSuccess?(F(s("checkout.orderSuccess")),c("/order-confirmation",{state:{order:x.data}})):m(s("checkout.orderFailed"))}catch{P.error(s("checkout.orderFailed"))}};return e.jsx("div",{className:"min-h-screen mt-10 mx-8 bg-white",children:e.jsxs("div",{className:"mx-auto px-4 py-8",children:[e.jsx(E,{items:[{label:s("breadcrumb.home"),path:"/"},{label:s("breadcrumb.cart"),path:"/cart"},{label:s("breadcrumb.checkout"),path:"/checkout"}]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsx("div",{className:"w-full lg:w-1/2",children:e.jsx(D,{formData:r,onInputChange:v,onPaymentMethodChange:k,onSubmit:N})}),e.jsx("div",{className:"w-full lg:w-1/2",children:e.jsx("div",{className:"bg-gray-100 rounded-[12px] p-6",children:e.jsx(O,{items:l,summary:y,handlePayment:N,loading:d})})})]})]})})}export{_ as default};
