import{j as e,r as m,u as C}from"./index-CxKmREMg.js";import{e as M}from"./common-BMvgh6M0.js";import{a as s,u as F,I as P,M as I}from"./App-ml3lkzHZ.js";import{f}from"./string-msUNxrnf.js";import{G as q}from"./Button-B8u0i0Tw.js";import{B as E}from"./Breadcrumb-i6hEoVxp.js";import{c as D,s as R,a as h}from"./request-BhcxZV3V.js";const $=({formData:l,onInputChange:a,onPaymentMethodChange:d,onSubmit:i})=>e.jsxs("form",{onSubmit:i,children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:s("lbl.shippingInformation")}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:s("lbl.receiverName")}),e.jsx("input",{type:"text",id:"name",name:"name",value:l.name,onChange:a,className:"w-full p-3 border border-gray-300 rounded-[12px] focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:s("lbl.receiverPhone")}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:l.phone,onChange:a,className:"w-full p-3 border border-gray-300 rounded-[12px] focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 mb-1",children:s("lbl.receiverAddress")}),e.jsx("input",{type:"text",id:"address",name:"address",value:l.address,onChange:a,className:"w-full p-3 border border-gray-300 rounded-[12px] focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:s("lbl.paymentMethod")}),e.jsx("div",{className:"space-y-3",children:M.map(n=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:n.id,name:"paymentMethod",value:n.id,checked:l.paymentMethod===n.id,onChange:()=>d(n.id),className:"h-5 w-5 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:n.id,className:"ml-3 text-base font-medium text-gray-700",children:n.label})]},n.id))})]})]}),A=({items:l,summary:a,handlePayment:d,loading:i})=>{const{subtotal:n,deliveryFee:u,total:o}=a;return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-6",children:s("lbl.orderSummary")}),e.jsx("div",{className:"divide-y divide-gray-200",children:l.map(r=>e.jsxs("div",{className:"py-4 flex",children:[e.jsx("div",{className:"h-20 w-20 flex-shrink-0 overflow-hidden rounded-md border border-gray-200",children:e.jsx("img",{src:r.product.mainImageUrl,alt:r.product.name,className:"h-full w-full object-cover object-center"})}),e.jsx("div",{className:"ml-4 flex flex-1 flex-col",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-base font-medium text-gray-900",children:[e.jsx("h3",{children:r.product.name}),e.jsx("p",{className:"ml-4",children:f(r.product.price*(100-r.product.discountPercent)/100*r.quantity,"VND")})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:`${s("lbl.quantity")}: ${r.quantity}`}),r.color&&e.jsxs("p",{className:"mt-1 text-sm text-gray-500 flex items-center",children:[s("lbl.color"),":"," ",e.jsx("span",{className:"ml-1 inline-block w-3 h-3 rounded-full",style:{backgroundColor:r.color}})]}),r.size&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:`${s("lbl.size")}: ${r.size}`})]})})]},r.id))}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("p",{className:"text-gray-600",children:s("lbl.subTotal")}),e.jsx("p",{className:"font-medium",children:f(n,"VND")})]}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("p",{className:"text-gray-600",children:s("lbl.deliveryFee")}),e.jsx("p",{className:"font-medium",children:f(u,"VND")})]}),e.jsxs("div",{className:"flex justify-between text-base font-medium mt-4",children:[e.jsx("p",{children:s("lbl.total")}),e.jsx("p",{children:f(o,"VND")})]})]}),e.jsx(q,{type:"submit",isLoading:i,onClick:d,className:"w-full mt-6 bg-black text-white py-4 px-6 rounded-full font-medium hover:bg-gray-800 transition-colors",children:s("lbl.makePayment")})]})},B="/orders",L=async l=>(await D.post(`${B}/checkout`,l)).data,O=()=>{const[l,a]=m.useState(!1),[d,i]=m.useState(null);return{loading:l,orderResponse:d,performCheckout:async u=>{a(!0);try{const o=await L(u);return o.isSuccess&&o.data&&i(o.data),a(!1),o}catch{a(!1);return}}}};function Y(){const l=F(),a=P(),{loading:d,performCheckout:i}=O(),[n,u]=m.useState([]),[o,r]=m.useState({subtotal:0,deliveryFee:0,total:0}),{userInfo:y}=C(t=>t.auth),[c,N]=m.useState({name:"",phone:"",address:"",paymentMethod:""});m.useEffect(()=>{const t=l.state;if(!t||!t.selectedCartItems||t.selectedCartItems.length===0){a("/cart");return}u(t.selectedCartItems),r(t.orderSummary)},[l,a]);const v=t=>{const{name:x,value:j}=t.target;N({...c,[x]:j})},k=t=>{N({...c,paymentMethod:t})},w=()=>{if(!c.name.trim())return h(s("checkout.validation.nameRequired")),!1;const t=/^[0-9]{9,11}$/;return!c.phone.trim()||!t.test(c.phone.trim())?(h(s("checkout.validation.invalidPhone")),!1):c.address.trim()?c.paymentMethod?!0:(h(s("checkout.validation.selectPaymentMethod")),!1):(h(s("checkout.validation.addressRequired")),!1)},g=async()=>{if(!w())return;const t=c.name.trim().split(" "),x=t.pop()||"",j=t.join(" ")||x,S=n.map(p=>({itemId:p.itemId,quantity:p.quantity}));try{const p={firstName:j,lastName:x,phoneNumber:c.phone.trim(),address:c.address.trim(),paymentMethod:c.paymentMethod,orderDetails:S,customerId:(y==null?void 0:y.id)||""},b=await i(p);b!=null&&b.isSuccess?(R(s("checkout.orderSuccess")),a("/order-confirmation",{state:{order:b.data}})):h(s("checkout.orderFailed"))}catch{I.error(s("checkout.orderFailed"))}};return e.jsx("div",{className:"min-h-screen mt-10 mx-8 bg-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx(E,{items:[{label:s("breadcrumb.home"),path:"/"},{label:s("breadcrumb.cart"),path:"/cart"},{label:s("breadcrumb.checkout"),path:"/checkout"}]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsx("div",{className:"w-full lg:w-1/2",children:e.jsx($,{formData:c,onInputChange:v,onPaymentMethodChange:k,onSubmit:g})}),e.jsx("div",{className:"w-full lg:w-1/2",children:e.jsx("div",{className:"bg-gray-100 rounded-[12px] p-6",children:e.jsx(A,{items:n,summary:o,handlePayment:g,loading:d})})})]})]})})}export{Y as default};
