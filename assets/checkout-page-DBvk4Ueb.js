import{j as e,r as x,u as S}from"./index-Cix6GTrn.js";import{e as M}from"./common-BTgaP-tl.js";import{a as s,u as F,I as P,M as q}from"./App-Dk_tdKar.js";import{f as p}from"./string-msUNxrnf.js";import{G as I}from"./Button-DJe4y4Rh.js";import{B as D}from"./Breadcrumb-F9YkXTWm.js";import{u as E}from"./order-DKRl5YsT.js";import{s as $,a as i}from"./request-9eYOFU4_.js";import"./button-DlzFqvrE.js";const B=({formData:n,onInputChange:c,onPaymentMethodChange:o,onSubmit:d})=>e.jsxs("form",{onSubmit:d,children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:s("lbl.shippingInformation")}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:s("lbl.receiverName")}),e.jsx("input",{type:"text",id:"name",name:"name",value:n.name,onChange:c,className:"w-full p-3 border border-gray-300 rounded-[12px] focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:s("lbl.receiverPhone")}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:n.phone,onChange:c,className:"w-full p-3 border border-gray-300 rounded-[12px] focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 mb-1",children:s("lbl.receiverAddress")}),e.jsx("input",{type:"text",id:"address",name:"address",value:n.address,onChange:c,className:"w-full p-3 border border-gray-300 rounded-[12px] focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:s("lbl.paymentMethod")}),e.jsx("div",{className:"space-y-3",children:M.map(r=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:r.id,name:"paymentMethod",value:r.id,checked:n.paymentMethod===r.id,onChange:()=>o(r.id),className:"h-5 w-5 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:r.id,className:"ml-3 text-base font-medium text-gray-700",children:r.label})]},r.id))})]})]}),V=({items:n,summary:c,handlePayment:o,loading:d})=>{const{subtotal:r,deliveryFee:b,total:f}=c;return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-6",children:s("lbl.orderSummary")}),e.jsx("div",{className:"divide-y divide-gray-200",children:n.map(a=>e.jsxs("div",{className:"py-4 flex",children:[e.jsx("div",{className:"h-20 w-20 flex-shrink-0 overflow-hidden rounded-md border border-gray-200",children:e.jsx("img",{src:a.product.mainImageUrl,alt:a.product.name,className:"h-full w-full object-cover object-center"})}),e.jsx("div",{className:"ml-4 flex flex-1 flex-col",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-base font-medium text-gray-900",children:[e.jsx("h3",{children:a.product.name}),e.jsx("p",{className:"ml-4",children:p(a.product.price*(100-a.product.discountPercent)/100*a.quantity,"VND")})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:`${s("lbl.quantity")}: ${a.quantity}`}),a.color&&e.jsxs("p",{className:"mt-1 text-sm text-gray-500 flex items-center",children:[s("lbl.color"),":"," ",e.jsx("span",{className:"ml-1 inline-block w-3 h-3 rounded-full",style:{backgroundColor:a.color}})]}),a.size&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:`${s("lbl.size")}: ${a.size}`})]})})]},a.id))}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("p",{className:"text-gray-600",children:s("lbl.subTotal")}),e.jsx("p",{className:"font-medium",children:p(r,"VND")})]}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("p",{className:"text-gray-600",children:s("lbl.deliveryFee")}),e.jsx("p",{className:"font-medium",children:p(b,"VND")})]}),e.jsxs("div",{className:"flex justify-between text-base font-medium mt-4",children:[e.jsx("p",{children:s("lbl.total")}),e.jsx("p",{children:p(f,"VND")})]})]}),e.jsx(I,{type:"submit",isLoading:d,onClick:o,className:"w-full mt-6 bg-black text-white py-4 px-6 rounded-full font-medium hover:bg-gray-800 transition-colors",children:s("lbl.makePayment")})]})};function Y(){const n=F(),c=P(),{loading:o,performCheckout:d}=E(),[r,b]=x.useState([]),[f,a]=x.useState({subtotal:0,deliveryFee:0,total:0}),{userInfo:y}=S(t=>t.auth),[l,N]=x.useState({name:"",phone:"",address:"",paymentMethod:""});x.useEffect(()=>{const t=n.state;if(!t||!t.selectedCartItems||t.selectedCartItems.length===0){c("/cart");return}b(t.selectedCartItems),a(t.orderSummary)},[n,c]);const v=t=>{const{name:m,value:j}=t.target;N({...l,[m]:j})},k=t=>{N({...l,paymentMethod:t})},w=()=>{if(!l.name.trim())return i(s("checkout.validation.nameRequired")),!1;const t=/^[0-9]{9,11}$/;return!l.phone.trim()||!t.test(l.phone.trim())?(i(s("checkout.validation.invalidPhone")),!1):l.address.trim()?l.paymentMethod?!0:(i(s("checkout.validation.selectPaymentMethod")),!1):(i(s("checkout.validation.addressRequired")),!1)},g=async()=>{if(!w())return;const t=l.name.trim().split(" "),m=t.pop()||"",j=t.join(" ")||m,C=r.map(u=>({itemId:u.itemId,quantity:u.quantity}));try{const u={firstName:j,lastName:m,phoneNumber:l.phone.trim(),address:l.address.trim(),paymentMethod:l.paymentMethod,orderDetails:C,customerId:(y==null?void 0:y.id)||""},h=await d(u);h!=null&&h.isSuccess?($(s("checkout.orderSuccess")),c("/order-confirmation",{state:{order:h.data}})):i(s("checkout.orderFailed"))}catch{q.error(s("checkout.orderFailed"))}};return e.jsx("div",{className:"min-h-screen mt-10 mx-8 bg-white",children:e.jsxs("div",{className:"mx-auto px-4 py-8",children:[e.jsx(D,{items:[{label:s("breadcrumb.home"),path:"/"},{label:s("breadcrumb.cart"),path:"/cart"},{label:s("breadcrumb.checkout"),path:"/checkout"}]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsx("div",{className:"w-full lg:w-1/2",children:e.jsx(B,{formData:l,onInputChange:v,onPaymentMethodChange:k,onSubmit:g})}),e.jsx("div",{className:"w-full lg:w-1/2",children:e.jsx("div",{className:"bg-gray-100 rounded-[12px] p-6",children:e.jsx(V,{items:r,summary:f,handlePayment:g,loading:o})})})]})]})})}export{Y as default};
