import{j as e,t,k as F,r as p,u as E,i as x,B as q,h as I}from"./index-BLqrUWS2.js";import{c as w}from"./common-Cbvgc8aE.js";import{f as j}from"./string-msUNxrnf.js";import{G as T}from"./Button-DSbSm6yS.js";import{B as A}from"./Breadcrumb-8GodHp_i.js";import{c as D,u as O}from"./order-B-qydF7J.js";import{u as $,E as _}from"./App-DMPOZ8dL.js";import"./button-CGJEczCT.js";const{PAYMENT_METHOD:B}=w,V=({formData:c,onInputChange:l,onPaymentMethodChange:i,onSubmit:m})=>e.jsxs("form",{onSubmit:m,children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:t("lbl.shippingInformation")}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:t("lbl.receiverName")}),e.jsx("input",{type:"text",id:"name",name:"name",value:c.name,onChange:l,className:"w-full p-3 border border-gray-300 rounded-[12px] focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:t("lbl.receiverPhone")}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:c.phone,onChange:l,className:"w-full p-3 border border-gray-300 rounded-[12px] focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 mb-1",children:t("lbl.receiverAddress")}),e.jsx("input",{type:"text",id:"address",name:"address",value:c.address,onChange:l,className:"w-full p-3 border border-gray-300 rounded-[12px] focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:t("lbl.paymentMethod")}),e.jsx("div",{className:"space-y-3",children:B.map(n=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",id:n.id,name:"paymentMethod",value:n.id,checked:c.paymentMethod===n.id,onChange:()=>i(n.id),className:"h-5 w-5 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:n.id,className:"ml-3 text-base font-medium text-gray-700",children:n.label})]},n.id))})]})]}),Y=({items:c,summary:l,handlePayment:i,loading:m})=>{var b;const{subtotal:n,deliveryFee:f,total:u}=l,{settings:d}=F(),h=((b=d.find(s=>s.key==="CurrencyCode"))==null?void 0:b.value)||"VND";return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-6",children:t("lbl.orderSummary")}),e.jsx("div",{className:"divide-y divide-gray-200",children:c.map(s=>e.jsxs("div",{className:"py-4 flex",children:[e.jsx("div",{className:"h-20 w-20 flex-shrink-0 overflow-hidden rounded-md border border-gray-200",children:e.jsx("img",{src:s.product.mainImageUrl,alt:s.product.name,className:"h-full w-full object-cover object-center"})}),e.jsx("div",{className:"ml-4 flex flex-1 flex-col",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-base font-medium text-gray-900",children:[e.jsx("h3",{children:s.product.name}),e.jsx("p",{className:"ml-4",children:j(s.product.price*(100-s.product.discountPercent)/100*s.quantity,h)})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:`${t("lbl.quantity")}: ${s.quantity}`}),s.color&&e.jsxs("p",{className:"mt-1 text-sm text-gray-500 flex items-center",children:[t("lbl.color"),":"," ",e.jsx("span",{className:"ml-1 inline-block w-3 h-3 rounded-full",style:{backgroundColor:s.color}})]}),s.size&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:`${t("lbl.size")}: ${s.size}`})]})})]},s.id))}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 mt-6",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("p",{className:"text-gray-600",children:t("lbl.subTotal")}),e.jsx("p",{className:"font-medium",children:j(n,h)})]}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("p",{className:"text-gray-600",children:t("lbl.deliveryFee")}),e.jsx("p",{className:"font-medium",children:j(f,h)})]}),e.jsxs("div",{className:"flex justify-between text-base font-medium mt-4",children:[e.jsx("p",{children:t("lbl.total")}),e.jsx("p",{children:j(u,h)})]})]}),e.jsx(T,{type:"submit",isLoading:m,onClick:i,className:"w-full mt-6 bg-black text-white py-4 px-6 rounded-full font-medium hover:bg-gray-800 transition-colors",children:t("lbl.makePayment")})]})},z=()=>{const[c,l]=p.useState(!1),[i,m]=p.useState(null);return{loading:c,paymentUrl:i,createPayment:async(f,u=!0)=>{l(!0);try{const d=await D(f);return m(d),u&&d&&(window.location.href=d),d}finally{l(!1)}}}},{PAYMENT_METHOD:H}=w;function X(){const c=$(),l=_(),{loading:i,performCheckout:m}=O(),{createPayment:n,loading:f}=z(),[u,d]=p.useState([]),[h,b]=p.useState({subtotal:0,deliveryFee:0,total:0}),{userInfo:s}=E(a=>a.auth),[r,N]=p.useState({name:"",phone:"",address:"",paymentMethod:""});p.useEffect(()=>{const a=c.state;if(!a||!a.selectedCartItems||a.selectedCartItems.length===0){l("/cart");return}d(a.selectedCartItems),b(a.orderSummary)},[c,l]);const k=a=>{const{name:o,value:g}=a.target;N({...r,[o]:g})},P=a=>{N({...r,paymentMethod:a})},C=()=>{if(!r.name.trim())return x(t("checkout.nameRequired")),!1;const a=/^[0-9]{9,11}$/;return!r.phone.trim()||!a.test(r.phone.trim())?(x(t("checkout.invalidPhone")),!1):r.address.trim()?r.paymentMethod?!0:(x(t("checkout.selectPaymentMethod")),!1):(x(t("checkout.addressRequired")),!1)},M=async a=>{const o=await m(a);o!=null&&o.isSuccess?(I(t("checkout.orderSuccess")),l("/order-confirmation",{state:{order:o.data}})):x(t("checkout.orderFailed"))},v=async()=>{if(!C())return;const a=r.name.trim().split(" "),o=a.pop()||"",g=a.join(" ")||o,S=u.map(y=>({itemId:y.itemId,quantity:y.quantity}));try{const y={firstName:g,lastName:o,phoneNumber:r.phone.trim(),address:r.address.trim(),paymentMethod:r.paymentMethod,orderDetails:S,customerId:(s==null?void 0:s.id)||""};r.paymentMethod===H[0].id?await M(y):r.paymentMethod==="VN_PAY"?await n(y,!0):x(t("checkout.invalidPaymentMethod"))}catch{q.error(t("checkout.orderFailed"))}};return e.jsx("div",{className:"min-h-screen mt-10 mx-8 bg-white",children:e.jsxs("div",{className:"mx-auto px-4 py-8",children:[e.jsx(A,{items:[{label:t("breadcrumb.home"),path:"/"},{label:t("breadcrumb.cart"),path:"/cart"},{label:t("breadcrumb.checkout"),path:"/checkout"}]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsx("div",{className:"w-full lg:w-1/2",children:e.jsx(V,{formData:r,onInputChange:k,onPaymentMethodChange:P,onSubmit:v})}),e.jsx("div",{className:"w-full lg:w-1/2",children:e.jsx("div",{className:"bg-gray-100 rounded-[12px] p-6",children:e.jsx(Y,{items:u,summary:h,handlePayment:v,loading:i||f})})})]})]})})}export{X as default};
