import{r as o,j as e,u as T}from"./index-D05w7RTC.js";import{B as Q}from"./Breadcrumb-DFXllJyQ.js";import{R as k,C as V,S as F,Q as M,A as Y,g as G,u as H,a as J}from"./products-CgvJBzW0.js";import{f as q}from"./string-msUNxrnf.js";import{a as m,B as b,C as L,J as K}from"./App-4Od_FrKz.js";import{f as W}from"./formatDate-l-LmQaxl.js";import{c as X,a as E}from"./request-B_Pa-C8s.js";import{L as Z}from"./Loading-DCK6rVum.js";import{u as ee}from"./cart-NTM_YuEt.js";import{d as te}from"./common-DGxg2YYd.js";const se=({images:t})=>{var i;const[a,s]=o.useState(0);return e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex md:flex-col gap-2",children:t.map((l,d)=>e.jsx("img",{src:l.url,className:`w-16 h-16 object-cover cursor-pointer rounded-[12px] ${a===d?"border-2 border-blue-500":""}`,onClick:()=>s(d)},l.id))}),e.jsx("div",{className:"flex-1",children:e.jsx("img",{src:(i=t[a])==null?void 0:i.url,className:"w-full h-auto rounded-[12px]"})})]})},ae=({currentPrice:t,originalPrice:a,discountPercentage:s,size:i="md"})=>{const l={sm:{current:"text-base font-bold",original:"text-sm text-gray-400 line-through",discount:"text-xs text-red-500 bg-red-100 px-1.5 py-0.5 rounded"},md:{current:"text-xl font-bold",original:"text-base text-gray-400 line-through",discount:"text-xs text-red-500 bg-red-100 px-2 py-0.5 rounded"},lg:{current:"text-2xl font-bold",original:"text-xl text-gray-400 line-through",discount:"text-sm text-red-500 bg-red-100 px-2 py-0.5 rounded"}};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:l[i].current,children:q(t,"VND")}),s!=0&&e.jsx("span",{className:l[i].original,children:q(a,"VND")}),s!=0&&e.jsxs("span",{className:l[i].discount,children:["-",s,"%"]})]})},re=({product:t,colors:a,productColorSize:s,sizes:i,handleAddToCart:l,isAdding:d})=>{const[c,x]=o.useState(""),[n,f]=o.useState(""),[g,u]=o.useState(""),[r,p]=o.useState(1),[y,j]=o.useState(t.total||0);o.useEffect(()=>{if(c&&n){const N=s.find(h=>h.color.id===c&&h.size.id===n);N?(u(N.id),j(N.quantity)):j(0)}else j(t.total||0)},[c,n,s,t.total]);const C=N=>{p(N==="increase"?h=>h<y?h+1:y:h=>h>1?h-1:1)};return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t.name}),e.jsx("span",{className:"text-xs font-semibold text-blue-800 bg-blue-100 px-4 py-1 rounded-full mt-1 inline-block",children:`${m("lbl.quantity")}: ${y}`}),e.jsx("span",{className:`text-xs font-semibold ${y>0?"text-green-800 bg-green-100":"text-red-800 bg-red-100"} px-4 py-1 rounded-full`,children:y>0?m("lbl.inStock"):m("lbl.outOfStock")})]}),e.jsx("div",{className:"flex items-center mb-4",children:e.jsx(k,{rating:t.averageRating})}),e.jsx("div",{className:"mb-4",children:e.jsx(ae,{currentPrice:t.price*(100-t.discountPercent)/100,originalPrice:t.price,discountPercentage:t.discountPercent,size:"lg"})}),e.jsx(V,{colors:a,selectedColor:c,onChange:x}),e.jsx(F,{sizes:i,selectedSize:n,onChange:f}),y>0&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(M,{quantity:r,onDecrement:()=>C("decrease"),onIncrement:()=>C("increase")}),e.jsx(Y,{isAdding:d,onClick:()=>l(r,g)})]})]})},ie=()=>{const[t,a]=o.useState(null),[s,i]=o.useState(null),l=d=>{var x;const c=(x=d.target.files)==null?void 0:x[0];if(c){const n=new FileReader;n.onload=f=>{var u;const g=(u=f.target)==null?void 0:u.result;a(g),setTimeout(()=>{i(g)},1e3)},n.readAsDataURL(c)}};return e.jsxs("div",{className:"min-h-screen bg-white flex flex-col items-center px-4 py-8",children:[e.jsx(b.h1,{className:"text-4xl font-bold text-center mb-12",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:"Virtual Try On"}),e.jsxs("div",{className:"w-full max-w-7xl grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[e.jsx(b.div,{className:"bg-gray-100 rounded-lg aspect-square flex items-center justify-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.1},children:t?e.jsx(b.img,{src:t,alt:"Uploaded",className:"w-full h-full object-contain",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3}}):null}),e.jsx(b.div,{className:"bg-gray-100 rounded-lg aspect-square flex items-center justify-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.2},children:t&&!s?e.jsx(b.div,{className:"w-16 h-16 border-4 border-gray-300 border-t-gray-600 rounded-full",animate:{rotate:360},transition:{duration:1,repeat:Number.POSITIVE_INFINITY,ease:"linear"}}):t?e.jsx(b.img,{src:t,alt:"Processing",className:"w-full h-full object-contain opacity-50",initial:{opacity:0},animate:{opacity:.5},transition:{duration:.3}}):null}),e.jsxs(b.div,{className:"bg-gray-100 rounded-lg aspect-square flex items-center justify-center overflow-hidden relative",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.3},children:[e.jsx(L,{children:!t&&e.jsx(b.span,{className:"text-gray-400 text-lg",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:"Result"})}),e.jsx(L,{children:s&&e.jsx(b.img,{src:s,alt:"Result",className:"w-full h-full object-contain",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5}})})]})]}),e.jsx(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},children:e.jsxs("label",{className:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-3 px-6 rounded-md cursor-pointer transition-colors duration-200",children:["Upload your image",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:l})]})})]})},ne=({description:t})=>e.jsxs("div",{className:"mt-16 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:m("lbl.description")}),e.jsx("div",{className:"border border-gray-200 rounded-[12px] p-4",dangerouslySetInnerHTML:{__html:t}})]}),le=({author:t,isVerified:a=!1,rating:s,content:i,date:l})=>e.jsxs("div",{className:"border border-gray-200 rounded-[12px] p-6 mb-4",children:[e.jsx("div",{className:"flex justify-between items-start mb-2",children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2",children:e.jsx(k,{rating:s})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium mr-2",children:t}),a&&e.jsx("span",{className:"bg-green-500 rounded-full w-4 h-4 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"âœ“"})}),e.jsxs("p",{className:"text-sm text-gray-500 mx-5",children:[m("lbl.postOn")," ",W(l)]})]})]})}),e.jsx("p",{className:"text-gray-700 my-2",children:i})]}),oe=async(t=0,a=10,s,i,l,d,c,x)=>{const n=new URLSearchParams;return n.append("page",t.toString()),n.append("size",a.toString()),s&&s.length&&s.forEach(g=>n.append("sort",g)),i&&n.append("keyword",i),l&&n.append("minRating",l.toString()),d&&n.append("maxRating",d.toString()),c&&n.append("orderDetailId",c),x&&n.append("productId",x),(await X.get(`/reviews?${n.toString()}`)).data},ce=()=>{const[t,a]=o.useState({data:[],pageable:null,loading:!1,error:null}),s=async(i=0,l=10,d,c,x,n,f,g)=>{var u;a(r=>({...r,loading:!0,error:null}));try{const r=await oe(i,l,d,c,x,n,f,g);return r.isSuccess?(a({data:(u=r==null?void 0:r.data)==null?void 0:u.content,pageable:r.data??null,loading:!1,error:null}),r.data):(a(p=>({...p,loading:!1,error:"Failed to fetch reviews"})),null)}catch(r){return a(p=>({...p,loading:!1,error:r instanceof Error?r.message:"An unknown error occurred"})),null}};return{reviews:t.data,pageable:t.pageable,loading:t.loading,error:t.error,fetchReviews:s}},de=({productId:t})=>{const{reviews:a,pageable:s,loading:i,error:l,fetchReviews:d}=ce(),[c,x]=o.useState(0),[n,f]=o.useState([]),g=5;o.useEffect(()=>{f([]),x(0),d(0,g,["createdAt,desc"],void 0,void 0,void 0,void 0,t)},[t]),o.useEffect(()=>{a&&a.length>0&&f(c===0?a:r=>{const p=new Set(r.map(j=>j.id)),y=a.filter(j=>!p.has(j.id));return[...r,...y]})},[a,c]);const u=()=>{if(s&&c<s.totalPages-1){const r=c+1;x(r),d(r,g,["createdAt,desc"],void 0,void 0,void 0,void 0,t)}};return i&&c===0?e.jsx("div",{className:"flex justify-center items-center mt-16 mb-8",children:e.jsx("div",{className:"loader",children:m("lbl.loading")})}):l?e.jsx("div",{className:"text-red-500",children:l}):e.jsxs("div",{className:"mt-16 mb-8",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("h2",{className:"text-xl font-bold",children:[m("lbl.allReviews")," ",e.jsxs("span",{className:"text-gray-500 font-normal",children:["(",(s==null?void 0:s.totalElements)||0,")"]})]})}),n&&n.length>0?e.jsxs(e.Fragment,{children:[n.map(r=>e.jsx(le,{author:r.userName,isVerified:!0,rating:r.rating,content:r.comment,date:r.createdAt},r.id)),s&&c<s.totalPages-1&&e.jsx("button",{className:"w-full py-3 border border-gray-300 rounded-[12px] text-gray-600 hover:bg-gray-50 transition-colors",onClick:u,disabled:i,children:i?m("btn.loading"):m("btn.loadMoreReviews")})]}):e.jsx("p",{className:"text-gray-500 text-center py-6",children:m("lbl.noReviewsYet")})]})},ue=()=>{const[t,a]=o.useState(!1);return{loading:t,fetchProductImages:async i=>{a(!0);try{return(await G(i)).data||null}finally{a(!1)}}}},ve=()=>{const{id:t}=K(),{fetchProductById:a,loading:s}=H(),{loading:i,fetchProductImages:l}=ue(),{loading:d,fetchProductColorSizes:c}=J(),[x,n]=o.useState([]),[f,g]=o.useState([]),[u,r]=o.useState(),[p,y]=o.useState([]),[j,C]=o.useState([]),[N,h]=o.useState(!1),{userInfo:w}=T(v=>v.auth),U=T(v=>v.auth.isAuthenticated),{addCartItem:_}=ee();o.useEffect(()=>{(async()=>{if(!t)return;const P=await a(t),I=await l(t),R=await c(t);if(R){C(R);const O=R.map(S=>S.color).filter((S,A,z)=>A===z.findIndex(D=>D.id===S.id)),$=R.map(S=>S.size).filter((S,A,z)=>A===z.findIndex(D=>D.id===S.id));n(O),g($)}P&&r(P),I&&y(I)})()},[t]);const B=async(v,P)=>{if(!(w!=null&&w.id)||!U){E(m("error.loginRequired"));return}if(!v){E(m("error.quantityRequired"));return}if(P===""){E(m("error.itemRequired"));return}const I={userId:w==null?void 0:w.id,itemId:P,quantity:v};await _(I)&&(h(!0),setTimeout(()=>{h(!1)},te))};return s||i||d?e.jsx(Z,{}):e.jsxs("div",{className:"max-w-7xl mt-10 px-4 py-8 font-sans",children:[e.jsx(Q,{items:[{label:m("breadcrumb.home"),path:"/"},{label:m("breadcrumb.detailProduct"),path:"/product"}]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[p&&e.jsx(se,{images:p}),u&&e.jsx(re,{product:u,colors:x,productColorSize:j,sizes:f,isAdding:N,handleAddToCart:B})]}),e.jsx(ie,{}),(u==null?void 0:u.description)&&e.jsx(ne,{description:u.description}),e.jsx(de,{})]})};export{ve as default};
