import{r as i,j as e,u as q}from"./index-Cix6GTrn.js";import{B as V}from"./Breadcrumb-F9YkXTWm.js";import{R as _,C as $,S as M,Q as F,A as Y,g as G,u as H,a as J}from"./products-BlLcRY0J.js";import{f as E}from"./string-msUNxrnf.js";import{a as d,B as g,C as L,J as K}from"./App-Dk_tdKar.js";import{f as W}from"./formatDate-B8_FTNZc.js";import{u as X}from"./reviews-C96steGB.js";import{L as Z}from"./Loading-Bqh7_7PO.js";import{u as ee}from"./cart-DuwOZSGJ.js";import{d as te}from"./common-BTgaP-tl.js";import{a as T}from"./request-9eYOFU4_.js";const se=({images:t})=>{var r;const[a,s]=i.useState(0);return e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex md:flex-col gap-2",children:t.map((n,u)=>e.jsx("img",{src:n.url,className:`w-24 h-24 object-cover cursor-pointer rounded-[12px] ${a===u?"border-2 border-blue-500":""}`,onClick:()=>s(u)},n.id))}),e.jsx("div",{className:"flex-1",children:e.jsx("img",{src:(r=t[a])==null?void 0:r.url,className:"w-full h-auto rounded-[12px]"})})]})},ae=({currentPrice:t,originalPrice:a,discountPercentage:s,size:r="md"})=>{const n={sm:{current:"text-base font-bold",original:"text-sm text-gray-400 line-through",discount:"text-xs text-red-500 bg-red-100 px-1.5 py-0.5 rounded"},md:{current:"text-xl font-bold",original:"text-base text-gray-400 line-through",discount:"text-xs text-red-500 bg-red-100 px-2 py-0.5 rounded"},lg:{current:"text-2xl font-bold",original:"text-xl text-gray-400 line-through",discount:"text-sm text-red-500 bg-red-100 px-2 py-0.5 rounded"}};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:n[r].current,children:E(t,"VND")}),s!=0&&e.jsx("span",{className:n[r].original,children:E(a,"VND")}),s!=0&&e.jsxs("span",{className:n[r].discount,children:["-",s,"%"]})]})},ie=({product:t,colors:a,productColorSize:s,sizes:r,handleAddToCart:n,isAdding:u})=>{const[l,h]=i.useState(""),[m,p]=i.useState(""),[y,o]=i.useState(""),[c,b]=i.useState(1),[f,j]=i.useState(t.total||0);i.useEffect(()=>{if(l&&m){const N=s.find(x=>x.color.id===l&&x.size.id===m);N?(o(N.id),j(N.quantity)):j(0)}else j(t.total||0)},[l,m,s,t.total]);const I=N=>{b(N==="increase"?x=>x<f?x+1:f:x=>x>1?x-1:1)};return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t.name}),e.jsx("span",{className:"text-xs font-semibold text-blue-800 bg-blue-100 px-4 py-1 rounded-full mt-1 inline-block",children:`${d("lbl.quantity")}: ${f}`}),e.jsx("span",{className:`text-xs font-semibold ${f>0?"text-green-800 bg-green-100":"text-red-800 bg-red-100"} px-4 py-1 rounded-full`,children:f>0?d("lbl.inStock"):d("lbl.outOfStock")})]}),e.jsx("div",{className:"flex items-center mb-4",children:e.jsx(_,{rating:t.averageRating})}),e.jsx("div",{className:"mb-4",children:e.jsx(ae,{currentPrice:t.price*(100-t.discountPercent)/100,originalPrice:t.price,discountPercentage:t.discountPercent,size:"lg"})}),e.jsx($,{colors:a,selectedColor:l,onChange:h}),e.jsx(M,{sizes:r,selectedSize:m,onChange:p}),f>0&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(F,{quantity:c,onDecrement:()=>I("decrease"),onIncrement:()=>I("increase")}),e.jsx(Y,{isAdding:u,onClick:()=>n(c,y)})]})]})},re=()=>{const[t,a]=i.useState(null),[s,r]=i.useState(null),n=u=>{var h;const l=(h=u.target.files)==null?void 0:h[0];if(l){const m=new FileReader;m.onload=p=>{var o;const y=(o=p.target)==null?void 0:o.result;a(y),setTimeout(()=>{r(y)},1e3)},m.readAsDataURL(l)}};return e.jsxs("div",{className:"min-h-screen bg-white flex flex-col items-center px-4 mt-10",children:[e.jsx(g.h1,{className:"text-4xl font-bold text-center mb-12",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:"Virtual Try On"}),e.jsxs("div",{className:"w-full max-w-7xl grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[e.jsx(g.div,{className:"bg-gray-100 rounded-lg aspect-square flex items-center justify-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.1},children:t?e.jsx(g.img,{src:t,alt:"Uploaded",className:"w-full h-full object-contain",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3}}):null}),e.jsx(g.div,{className:"bg-gray-100 rounded-lg aspect-square flex items-center justify-center overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.2},children:t&&!s?e.jsx(g.div,{className:"w-16 h-16 border-4 border-gray-300 border-t-gray-600 rounded-full",animate:{rotate:360},transition:{duration:1,repeat:Number.POSITIVE_INFINITY,ease:"linear"}}):t?e.jsx(g.img,{src:t,alt:"Processing",className:"w-full h-full object-contain opacity-50",initial:{opacity:0},animate:{opacity:.5},transition:{duration:.3}}):null}),e.jsxs(g.div,{className:"bg-gray-100 rounded-lg aspect-square flex items-center justify-center overflow-hidden relative",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.3},children:[e.jsx(L,{children:!t&&e.jsx(g.span,{className:"text-gray-400 text-lg",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:"Result"})}),e.jsx(L,{children:s&&e.jsx(g.img,{src:s,alt:"Result",className:"w-full h-full object-contain",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5}})})]})]}),e.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},children:e.jsxs("label",{className:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-3 px-6 rounded-md cursor-pointer transition-colors duration-200",children:["Upload your image",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:n})]})})]})},ne=({description:t})=>e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:d("lbl.description")}),e.jsx("div",{className:"border border-gray-200 rounded-[12px] p-4",dangerouslySetInnerHTML:{__html:t}})]}),le=({author:t,isVerified:a=!1,rating:s,content:r,date:n})=>e.jsxs("div",{className:"border border-gray-200 rounded-[12px] p-6 mb-4",children:[e.jsx("div",{className:"flex justify-between items-start mb-2",children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2",children:e.jsx(_,{rating:s})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium mr-2",children:t}),a&&e.jsx("span",{className:"bg-green-500 rounded-full w-4 h-4 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"âœ“"})}),e.jsxs("p",{className:"text-sm text-gray-500 mx-5",children:[d("lbl.postOn")," ",W(n)]})]})]})}),e.jsx("p",{className:"text-gray-700 my-2",children:r})]}),oe=({productId:t})=>{const{reviews:a,pageable:s,loading:r,error:n,fetchReviews:u}=X(),[l,h]=i.useState(0),[m,p]=i.useState([]),y=5;i.useEffect(()=>{p([]),h(0),u(0,y,["createdAt,desc"],void 0,void 0,void 0,void 0,t)},[t]),i.useEffect(()=>{a&&a.length>0&&p(l===0?a:c=>{const b=new Set(c.map(j=>j.id)),f=a.filter(j=>!b.has(j.id));return[...c,...f]})},[a,l]);const o=()=>{if(s&&l<s.totalPages-1){const c=l+1;h(c),u(c,y,["createdAt,desc"],void 0,void 0,void 0,void 0,t)}};return r&&l===0?e.jsx("div",{className:"flex justify-center items-center mt-16 mb-8",children:e.jsx("div",{className:"loader",children:d("lbl.loading")})}):n?e.jsx("div",{className:"text-red-500",children:n}):e.jsxs("div",{className:"mt-16 mb-8",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("h2",{className:"text-xl font-bold",children:[d("lbl.allReviews")," ",e.jsxs("span",{className:"text-gray-500 font-normal",children:["(",(s==null?void 0:s.totalElements)||0,")"]})]})}),m&&m.length>0?e.jsxs(e.Fragment,{children:[m.map(c=>e.jsx(le,{author:c.userName,isVerified:!0,rating:c.rating,content:c.comment,date:c.createdAt},c.id)),s&&l<s.totalPages-1&&e.jsx("button",{className:"w-full py-3 border border-gray-300 rounded-[12px] text-gray-600 hover:bg-gray-50 transition-colors",onClick:o,disabled:r,children:r?d("btn.loading"):d("btn.loadMoreReviews")})]}):e.jsx("p",{className:"text-gray-500 text-center py-6",children:d("lbl.noReviewsYet")})]})},ce=()=>{const[t,a]=i.useState(!1);return{loading:t,fetchProductImages:async r=>{a(!0);try{return(await G(r)).data||null}finally{a(!1)}}}},Ne=()=>{const{id:t}=K(),{fetchProductById:a,loading:s}=H(),{loading:r,fetchProductImages:n}=ce(),{loading:u,fetchProductColorSizes:l}=J(),[h,m]=i.useState([]),[p,y]=i.useState([]),[o,c]=i.useState(),[b,f]=i.useState([]),[j,I]=i.useState([]),[N,x]=i.useState(!1),{userInfo:w}=q(v=>v.auth),k=q(v=>v.auth.isAuthenticated),{addCartItem:B}=ee();i.useEffect(()=>{(async()=>{if(!t)return;const P=await a(t),R=await n(t),C=await l(t);if(C){I(C);const U=C.map(S=>S.color).filter((S,A,z)=>A===z.findIndex(D=>D.id===S.id)),Q=C.map(S=>S.size).filter((S,A,z)=>A===z.findIndex(D=>D.id===S.id));m(U),y(Q)}P&&c(P),R&&f(R)})()},[t]);const O=async(v,P)=>{if(!(w!=null&&w.id)||!k){T(d("error.loginRequired"));return}if(!v){T(d("error.quantityRequired"));return}if(P===""){T(d("error.itemRequired"));return}const R={userId:w==null?void 0:w.id,itemId:P,quantity:v};await B(R)&&(x(!0),setTimeout(()=>{x(!1)},te))};return s||r||u?e.jsx(Z,{}):e.jsxs("div",{className:"mt-10 px-4 py-8 font-sans",children:[e.jsx(V,{items:[{label:d("breadcrumb.home"),path:"/"},{label:d("breadcrumb.detailProduct"),path:"/product"}]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[b&&e.jsx(se,{images:b}),o&&e.jsx(ie,{product:o,colors:h,productColorSize:j,sizes:p,isAdding:N,handleAddToCart:O})]}),e.jsx(re,{}),(o==null?void 0:o.description)&&e.jsx(ne,{description:o.description}),e.jsx(oe,{productId:o==null?void 0:o.id})]})};export{Ne as default};
