import{j as e,t as o,r as d,m as U,b as $,i as C,h as B,x as q}from"./index-G0QzuUAk.js";import{c as N,A as D,z as w}from"./App-C_Cwg5rh.js";import{I as f}from"./InputField-CEqoXxbU.js";import{u as W}from"./user-BY3CNerC.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=N("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=N("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=N("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),K=({showSavedMessage:t})=>e.jsx(e.Fragment,{children:e.jsx(D,{children:t&&e.jsx(w.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"absolute top-0 right-0 mt-4 mr-4 bg-green-100 text-green-800 px-4 py-2 rounded-lg shadow-md",children:o("profile.updateProfile")})})}),O=({previewImage:t,isEditing:a,isUploading:l=!1,onImageChange:n})=>{const u=d.useRef(null),h=()=>{a&&!l&&u.current&&u.current.click()};return e.jsxs("div",{className:"relative group cursor-pointer",onClick:h,children:[e.jsxs(w.div,{whileHover:{scale:a&&!l?1.05:1},whileTap:{scale:a&&!l?.95:1},className:"h-32 w-32 sm:h-40 sm:w-40 rounded-full border-4 border-white overflow-hidden bg-white shadow-lg",children:[e.jsx("img",{src:t||"/placeholder.svg",alt:"Profile",className:"h-full w-full object-cover"}),a&&!l&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(_,{className:"h-8 w-8 text-white"})}),l&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsx(G,{className:"h-8 w-8 text-white animate-spin"})})]}),e.jsx("input",{type:"file",ref:u,onChange:n,accept:"image/*",className:"hidden",disabled:!a||l})]})},Q=({formData:t,isEditing:a,isSaving:l,handleChange:n,handleSubmit:u,cancelEdit:h})=>e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(f,{id:"firstName",label:o("lbl.firstName"),name:"firstName",value:t.firstName,onChange:n,disabled:!a,className:a?"":"bg-gray-50 border-transparent"}),e.jsx(f,{id:"lastName",label:o("lbl.lastName"),name:"lastName",value:t.lastName,onChange:n,disabled:!a,className:a?"":"bg-gray-50 border-transparent"}),e.jsx(f,{id:"email",label:"Email",type:"email",name:"email",value:t.email,onChange:n,disabled:!0,className:"bg-gray-50 border-transparent"}),e.jsx(f,{id:"phone",label:o("lbl.phone"),type:"tel",name:"phoneNum",value:t.phoneNumber,onChange:n,disabled:!a,className:a?"":"bg-gray-50 border-transparent"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:o("lbl.address")}),e.jsx("textarea",{name:"address",value:t.address,onChange:n,disabled:!a,rows:3,className:`w-full px-4 py-2 border rounded-[10px] ${a?"border-gray-300 bg-white":"border-transparent bg-gray-50"} rounded-lg focus:outline-none focus:ring-2 focus:ring-rose-500 transition-all duration-200`})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(f,{id:"weight",label:o("lbl.weight"),name:"weight",value:t.weight,onChange:n,disabled:!a,placeholder:"e.g. 70 kg",className:a?"":"bg-gray-50 border-transparent"}),e.jsx(f,{id:"height",label:o("lbl.height"),name:"height",value:t.height,onChange:n,disabled:!a,placeholder:"e.g. 175 cm",className:a?"":"bg-gray-50 border-transparent"})]})]}),a&&e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-8 flex justify-end",children:[e.jsx("button",{type:"button",onClick:h,className:"mr-4 px-6 py-3 bg-gray-200 text-gray-700 rounded-[12px] hover:bg-gray-300 transition-colors",children:o("lbl.cancel")}),e.jsx("button",{type:"submit",disabled:l,className:`flex items-center px-6 py-3 bg-rose-500 text-white rounded-[12px] hover:bg-rose-600 transition-colors ${l?"opacity-70 cursor-not-allowed":""}`,children:l?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),o("lbl.saving")]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-5 w-5 mr-2"}),o("lbl.saveChanges")]})})]})]}),M="/images",F={uploadImage:async t=>{const a=new FormData;return a.append("file",t),(await U.post(`${M}/upload`,a,{headers:{"Content-Type":"multipart/form-data"}})).data},deleteImage:async t=>(await U.delete(`${M}/delete`,{params:{imageUrl:t}})).data},X=()=>{const[t,a]=d.useState({uploading:!1,deleting:!1,imageUrl:null,error:null});return{uploadImage:async p=>{a(r=>({...r,uploading:!0,error:null}));try{const r=await F.uploadImage(p);if(r.isSuccess&&r.data){const s=r.data;return a(c=>({...c,uploading:!1,imageUrl:s})),s}else return a(s=>({...s,uploading:!1,error:"Failed to upload image"})),null}catch(r){const s=r instanceof Error?r.message:"An error occurred during upload";return a(c=>({...c,uploading:!1,error:s})),null}},deleteImage:async p=>{a(r=>({...r,deleting:!0,error:null}));try{const r=await F.deleteImage(p);return r.isSuccess&&r.data?(a(s=>({...s,deleting:!1,imageUrl:s.imageUrl===p?null:s.imageUrl})),!0):(a(s=>({...s,deleting:!1,error:"Failed to delete image"})),!1)}catch(r){const s=r instanceof Error?r.message:"An error occurred during deletion";return a(c=>({...c,deleting:!1,error:s})),!1}},clearError:()=>{a(p=>({...p,error:null}))},reset:()=>{a({uploading:!1,deleting:!1,imageUrl:null,error:null})},imageUrl:t.imageUrl,uploading:t.uploading,deleting:t.deleting,error:t.error}},ae=()=>{const t=$(),{fetchUserByToken:a,user:l,updateUser:n,loading:u}=W(),{uploadImage:h,uploading:p,error:r}=X(),[s,c]=d.useState(null),[v,j]=d.useState(!1),[P,b]=d.useState(null),[A,k]=d.useState(null),[H,I]=d.useState(!1),[z,S]=d.useState(!1);d.useEffect(()=>{(async()=>{const i=await a();i&&(c(i),b(i.photo||null))})()},[]),d.useEffect(()=>{r&&C(r)},[r]);const L=g=>{const{name:i,value:m}=g.target;c(x=>x?{...x,[i]:m}:null)},R=async g=>{var m;const i=(m=g.target.files)==null?void 0:m[0];if(i){const x=new FileReader;x.onloadend=()=>{const y=x.result;b(y)},x.readAsDataURL(i);try{const y=await h(i);y&&(k(y),B(o("profile.imageUploaded")))}catch{C(o("profile.imageUploadFailed")),b((s==null?void 0:s.photo)||null)}}},T=async g=>{if(g.preventDefault(),!s)return;I(!0);const i={firstName:s.firstName,lastName:s.lastName,phoneNumber:s.phoneNumber,address:s.address,height:s.height,weight:s.weight,photo:A||s.photo},m=await n(s.id,i);m&&(c(m),b(m.photo||null),t(q(m)),j(!1),S(!0),setTimeout(()=>{S(!1)},3e3)),I(!1)},V=()=>{j(!1),k(null),l&&(c(l),b(l.photo||null))};return u||!s?e.jsx("div",{className:"h-screen w-full flex items-center justify-center bg-white",children:e.jsx("div",{className:"animate-pulse text-3xl font-bold",children:o("lbl.loading")})}):e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 mt-20",children:e.jsxs("div",{className:"bg-white overflow-hidden relative",children:[e.jsx(K,{showSavedMessage:z}),e.jsxs("div",{className:"px-4 sm:px-6 pb-6 relative mt-20",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-end -mt-16 sm:-mt-20 mb-6 sm:mb-8 relative",children:[e.jsx(O,{previewImage:P||"",isEditing:v,onImageChange:R,isUploading:p}),e.jsxs("div",{className:"sm:mt-0 sm:ml-6 text-center sm:text-left mb-10",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-gray-600",children:s.email})]}),e.jsx("div",{className:"mt-4 sm:mt-0 sm:ml-auto",children:v?null:e.jsx(w.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>j(!0),className:"px-4 py-2 bg-rose-500 text-white rounded-[12px] hover:bg-rose-600 transition-colors",children:o("lbl.editProfile")})})]}),e.jsx(Q,{formData:s,isEditing:v,isSaving:H,handleChange:L,handleSubmit:T,cancelEdit:V})]})]})})};export{ae as default};
